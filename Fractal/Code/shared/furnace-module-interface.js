!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.system=t():e.system=t()}(global,(()=>(()=>{"use strict";var e={817:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.BufferWriteHelper=t.BufferReadHelper=void 0,t.BufferReadHelper=class{constructor(e){this.buffer=e,this.buffer=e,this.position=0}skipBytes(e){this.position=this.getPosition(e)}getPosition(e){let t=this.position;if(e){if(t+e<0||t+e>this.buffer.byteLength)throw new RangeError("Buffer position is out of range!");t+=e}return t}setPosition(e){if(e<0||e>this.buffer.byteLength)throw new RangeError("Buffer position is out of range!");this.position=e}getASCII(e,t){const a=null!=t?t:this.position;if(a+e>this.buffer.length)throw new RangeError("String length is too large for buffer!");return this.setPosition(a+e),this.buffer.toString("ascii",a,a+e)}readString(e,t){const a=this.findByte(0,t),r=null!=t?t:this.position;return this.setPosition(a+1),this.buffer.toString(e,r,a)}findByte(e,t){let a=null!=t?t:this.position;for(;a<this.buffer.length;){if(this.buffer.readUInt8(a)===e)return a;a++}throw new RangeError("Could not find the requested byte before end of buffer!")}readBuffer(e,t){const a=null!=t?t:this.position;if(a+e>this.buffer.length)throw new RangeError("Array length is too large for buffer!");return t||this.setPosition(this.position+e),this.buffer.subarray(a,a+e)}readInt8(e){const t=null!=e?e:this.position;return e||this.setPosition(this.position+1),this.buffer.readInt8(t)}readUInt8(e){const t=null!=e?e:this.position;return e||this.setPosition(this.position+1),this.buffer.readUInt8(t)}readInt16LE(e){const t=null!=e?e:this.position;return e||this.setPosition(this.position+2),this.buffer.readInt16LE(t)}readUInt16LE(e){const t=null!=e?e:this.position;return e||this.setPosition(this.position+2),this.buffer.readUInt16LE(t)}readInt32LE(e){const t=null!=e?e:this.position;return e||this.setPosition(this.position+4),this.buffer.readInt32LE(t)}readUInt32LE(e){const t=null!=e?e:this.position;return e||this.setPosition(this.position+4),this.buffer.readUInt32LE(t)}readFloat32LE(e){const t=null!=e?e:this.position;return e||this.setPosition(this.position+4),this.buffer.readFloatLE(t)}},t.BufferWriteHelper=class{constructor(){this.buffer=Buffer.alloc(4096),this.position=0}getTrimmedBuffer(){return this.buffer.subarray(0,this.position)}expandBuffer(e){if(this.buffer.byteLength>e)return;if(e<0||e>Number.MAX_VALUE)throw new RangeError("Buffer position "+e+" is invalid!");let t=this.buffer.byteLength<<1;for(;t<e;)t<<=1;if(t<0||t>Number.MAX_VALUE)throw new RangeError("Buffer size "+t+" is invalid!");this.buffer=Buffer.concat([this.buffer,Buffer.alloc(t-this.buffer.byteLength)])}skipBytes(e){this.position=this.getPosition(e),this.expandBuffer(this.position)}getPosition(e){let t=this.position;return e&&((t+e<0||t+e>this.buffer.byteLength)&&this.expandBuffer(t+e),t+=e),t}setPosition(e){(e<0||e>=this.buffer.byteLength)&&this.expandBuffer(e),this.position=e}writeString(e,t,a,r){const n=null!=r?r:this.position;this.expandBuffer(n+2*e.length);let s=this.buffer.write(e,n,t);return a&&(this.writeInt8(0,n+s),s++),r||this.setPosition(this.position+s),s}writeBuffer(e,t,a,r){const n=null!=r?r:this.position;r||this.setPosition(this.position+a),this.expandBuffer(n+a-1);for(let r=0;r<a;r++)this.buffer.writeUint8(e.readUint8(t+r),n+r);return a}writeInt8(e,t){const a=null!=t?t:this.position;return t||this.setPosition(this.position+1),this.expandBuffer(a),this.buffer.writeInt8(e,a)}writeUInt8(e,t){const a=null!=t?t:this.position;return t||this.setPosition(this.position+1),this.expandBuffer(a),this.buffer.writeUInt8(e,a)}writeInt16LE(e,t){const a=null!=t?t:this.position;return t||this.setPosition(this.position+2),this.expandBuffer(a+1),this.buffer.writeInt16LE(e,a)}writeUInt16LE(e,t){const a=null!=t?t:this.position;return t||this.setPosition(this.position+2),this.expandBuffer(a+1),this.buffer.writeUInt16LE(e,a)}writeInt32LE(e,t){const a=null!=t?t:this.position;return t||this.setPosition(this.position+4),this.expandBuffer(a+3),this.buffer.writeInt32LE(e,a)}writeUInt32LE(e,t){const a=null!=t?t:this.position;return t||this.setPosition(this.position+4),this.expandBuffer(a+3),this.buffer.writeUInt32LE(e,a)}writeFloat32LE(e,t){const a=null!=t?t:this.position;return t||this.setPosition(this.position+4),this.expandBuffer(a+3),this.buffer.writeFloatLE(e,a)}}},61:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.computeChannelCount=t.computeChannelObjects=t.FurnaceChannel=t.FurnaceChannelInfo=void 0;const r=a(235);class n{constructor(){this.longname="",this.shortname="",this.orders=[],this.patterns=new Array(256).fill(null),this.effects=r.defaults.effects,this.hidden=!1,this.collapsed=!1}}t.FurnaceChannelInfo=n;class s{constructor(e,t,a,r){this.channel=e,this.info=t,this.system=a,this.chip=r}get parentSystem(){return this.system}get parentChip(){return this.chip}get longname(){return this.info.longname}set longname(e){this.info.longname=e}get shortname(){return this.info.shortname}set shortname(e){this.info.shortname=e}get defaultLongname(){return this.channel.longname}get defaultShortname(){return this.channel.shortname}get activeLongname(){return this.info.longname.length>0?this.info.longname:this.channel.longname}get activeShortname(){return this.info.shortname.length>0?this.info.shortname:this.channel.shortname}get collapsed(){return this.info.collapsed}get hidden(){return this.info.hidden}get effectCount(){return this.info.effects}get orders(){return this.info.orders}get patterns(){return this.info.patterns}makePartialCopy(){const e=new n;return e.longname=this.longname,e.shortname=this.shortname,e.orders=this.orders,e.patterns=this.patterns,e.effects=this.effectCount,e.hidden=this.hidden,e.collapsed=this.collapsed,new s(this.channel,e,this.system,this.chip)}create(e,t,a,r){return new s(e,t,a,r)}}t.FurnaceChannel=s,t.computeChannelObjects=function(e,t){const a=[];return e.systems.forEach((e=>{e.chips.forEach((r=>{r.channels.forEach((n=>{const o=a.length;a.push(new s(n,t[o],e,r))}))}))})),a},t.computeChannelCount=function(e){let t=0;return e.systems.forEach((e=>{t+=e.chips.reduce(((e,t)=>e+t.channels.length),0)})),t}},596:(e,t)=>{var a,r;Object.defineProperty(t,"__esModule",{value:!0}),t.FurnaceChipVRC7=t.FurnaceSystemVRC7=t.FurnaceChipVRC6=t.FurnaceSystemVRC6=t.FurnaceSystemNESVRC7=t.FurnaceChipRicoh2A03=t.FurnaceSystemNES=t.FurnaceChipPCEngine=t.FurnaceSystemPCEngine=t.FurnaceChipGameBoy=t.FurnaceSystemGameBoy=t.FurnaceChipYM2612ExtendedWithDualPCM=t.FurnaceSystemYM2612ExtendedWithDualPCM=t.FurnaceChipYM2612Extended=t.FurnaceSystemYM2612Extended=t.FurnaceSystemGenesisExtended=t.FurnaceChipYM2612WithDualPCM=t.FurnaceSystemYM2612WithDualPCM=t.FurnaceChipYM2612=t.FurnaceSystemYM2612=t.FurnaceSystemGenesis=t.FurnaceChipSN76489=t.FurnaceSystemSMS=t.FurnaceChipEnum=t.FurnaceSystemEnum=t.loadSystem=void 0,t.loadSystem=function(e){switch(e){case a.Null:return null;case a.GameBoy:return new g;case a.PCEngine:return new w;case a.SMS:return new n;case a.YM2612:return new i;case a.YM2612Extended:return new m;case a.Genesis:return new o;case a.GenesisExtended:return new u;case a.YM2612WithDualPCM:return new c;case a.YM2612ExtendedWithDualPCM:return new p;case a.NES:return new x;case a.NESVRC7:return new E;case a.KonamiVRC6:return new S;case a.KonamiVRC7:return new y}throw new Error("Unknown or unsupported system id 0x"+e.toString(16))},function(e){e[e.Null=0]="Null",e[e.Genesis=2]="Genesis",e[e.GenesisExtended=66]="GenesisExtended",e[e.YM2612=131]="YM2612",e[e.YM2612Extended=160]="YM2612Extended",e[e.SMS=3]="SMS",e[e.YM2612WithDualPCM=190]="YM2612WithDualPCM",e[e.YM2612ExtendedWithDualPCM=189]="YM2612ExtendedWithDualPCM",e[e.GameBoy=4]="GameBoy",e[e.PCEngine=5]="PCEngine",e[e.NES=6]="NES",e[e.NESVRC7=70]="NESVRC7",e[e.KonamiVRC6=136]="KonamiVRC6",e[e.KonamiVRC7=157]="KonamiVRC7"}(a=t.FurnaceSystemEnum||(t.FurnaceSystemEnum={})),function(e){e[e.YM2612=131]="YM2612",e[e.YM2612Extended=160]="YM2612Extended",e[e.DualPCMYM2612=190]="DualPCMYM2612",e[e.DualPCMYM2612Extended=189]="DualPCMYM2612Extended",e[e.SN76489=3]="SN76489",e[e.GameBoy=4]="GameBoy",e[e.PCEngine=5]="PCEngine",e[e.Ricoh2A03=6]="Ricoh2A03",e[e.VRC6=136]="VRC6",e[e.VRC7=157]="VRC7"}(r=t.FurnaceChipEnum||(t.FurnaceChipEnum={}));class n{constructor(){this.systemId=a.SMS,this.name="SMS (SN76489)",this.chips=[new s]}}t.FurnaceSystemSMS=n;class s{constructor(){this.chipId=r.SN76489,this.channels=[{longname:"Square 1",shortname:"S1"},{longname:"Square 2",shortname:"S2"},{longname:"Square 3",shortname:"S3"},{longname:"Noise",shortname:"NO"}],this.volume=64,this.panning=0,this.flags=0}}t.FurnaceChipSN76489=s;class o{constructor(){this.systemId=a.Genesis,this.name="Genesis",this.chips=[new l,new s]}}t.FurnaceSystemGenesis=o;class i{constructor(){this.systemId=a.YM2612,this.name="YM2612 alone",this.chips=[new l]}}t.FurnaceSystemYM2612=i;class l{constructor(){this.chipId=r.YM2612,this.channels=[{longname:"FM 1",shortname:"F1"},{longname:"FM 2",shortname:"F2"},{longname:"FM 3",shortname:"F3"},{longname:"FM 4",shortname:"F4"},{longname:"FM 5",shortname:"F5"},{longname:"FM 6",shortname:"F6"}],this.volume=64,this.panning=0,this.flags=0}}t.FurnaceChipYM2612=l;class c{constructor(){this.systemId=a.YM2612WithDualPCM,this.name="YM2612 With Dual PCM",this.chips=[new h]}}t.FurnaceSystemYM2612WithDualPCM=c;class h{constructor(){this.chipId=r.DualPCMYM2612,this.channels=[{longname:"FM 1",shortname:"F1"},{longname:"FM 2",shortname:"F2"},{longname:"FM 3",shortname:"F3"},{longname:"FM 4",shortname:"F4"},{longname:"FM 5",shortname:"F5"},{longname:"FM 6/PCM 1",shortname:"P1"},{longname:"PCM 2",shortname:"P2"}],this.volume=64,this.panning=0,this.flags=0}}t.FurnaceChipYM2612WithDualPCM=h;class u{constructor(){this.systemId=a.GenesisExtended,this.name="Genesis Extended",this.chips=[new f,new s]}}t.FurnaceSystemGenesisExtended=u;class m{constructor(){this.systemId=a.YM2612Extended,this.name="YM2612 Extended",this.chips=[new f]}}t.FurnaceSystemYM2612Extended=m;class f{constructor(){this.chipId=r.DualPCMYM2612Extended,this.channels=[{longname:"FM 1",shortname:"F1"},{longname:"FM 2",shortname:"F2"},{longname:"FM 3 OP1",shortname:"O1"},{longname:"FM 3 OP2",shortname:"O2"},{longname:"FM 3 OP3",shortname:"O3"},{longname:"FM 3 OP4",shortname:"O4"},{longname:"FM 4",shortname:"F4"},{longname:"FM 5",shortname:"F5"},{longname:"FM 6",shortname:"F6"}],this.volume=64,this.panning=0,this.flags=0}}t.FurnaceChipYM2612Extended=f;class p{constructor(){this.systemId=a.YM2612ExtendedWithDualPCM,this.name="YM2612 Extended With Dual PCM and CSM",this.chips=[new d]}}t.FurnaceSystemYM2612ExtendedWithDualPCM=p;class d{constructor(){this.chipId=r.DualPCMYM2612Extended,this.channels=[{longname:"FM 1",shortname:"F1"},{longname:"FM 2",shortname:"F2"},{longname:"FM 3 OP1",shortname:"O1"},{longname:"FM 3 OP2",shortname:"O2"},{longname:"FM 3 OP3",shortname:"O3"},{longname:"FM 3 OP4",shortname:"O4"},{longname:"FM 4",shortname:"F4"},{longname:"FM 5",shortname:"F5"},{longname:"FM 6/PCM 1",shortname:"P1"},{longname:"PCM 2",shortname:"P2"},{longname:"CSM Timer",shortname:"CSM"}],this.volume=64,this.panning=0,this.flags=0}}t.FurnaceChipYM2612ExtendedWithDualPCM=d;class g{constructor(){this.systemId=a.GameBoy,this.name="Game Boy",this.chips=[new v]}}t.FurnaceSystemGameBoy=g;class v{constructor(){this.chipId=r.GameBoy,this.channels=[{longname:"Pulse 1",shortname:"S1"},{longname:"Pulse 2",shortname:"S2"},{longname:"Wavetable",shortname:"WA"},{longname:"Noise",shortname:"NO"}],this.volume=64,this.panning=0,this.flags=0}}t.FurnaceChipGameBoy=v;class w{constructor(){this.systemId=a.PCEngine,this.name="PC Engine",this.chips=[new I]}}t.FurnaceSystemPCEngine=w;class I{constructor(){this.chipId=r.PCEngine,this.channels=[{longname:"Channel 1",shortname:"CH1"},{longname:"Channel 2",shortname:"CH2"},{longname:"Channel 3",shortname:"CH3"},{longname:"Channel 4",shortname:"CH4"},{longname:"Channel 5",shortname:"CH5"},{longname:"Channel 6",shortname:"CH6"}],this.volume=64,this.panning=0,this.flags=0}}t.FurnaceChipPCEngine=I;class x{constructor(){this.systemId=a.NES,this.name="NES",this.chips=[new M]}}t.FurnaceSystemNES=x;class M{constructor(){this.chipId=r.Ricoh2A03,this.channels=[{longname:"Pulse 1",shortname:"S1"},{longname:"Pulse 2",shortname:"S2"},{longname:"Triangle",shortname:"TR"},{longname:"Noise",shortname:"NO"},{longname:"PCM",shortname:"PCM"}],this.volume=64,this.panning=0,this.flags=0}}t.FurnaceChipRicoh2A03=M;class E{constructor(){this.systemId=a.NES,this.name="NES With Konami VRC7",this.chips=[new M,new U]}}t.FurnaceSystemNESVRC7=E;class S{constructor(){this.systemId=a.NES,this.name="Konami VRC6",this.chips=[new F]}}t.FurnaceSystemVRC6=S;class F{constructor(){this.chipId=r.Ricoh2A03,this.channels=[{longname:"VRC6 1",shortname:"V1"},{longname:"VRC6 2",shortname:"V2"},{longname:"VRC6 Saw",shortname:"VS"}],this.volume=64,this.panning=0,this.flags=0}}t.FurnaceChipVRC6=F;class y{constructor(){this.systemId=a.NES,this.name="Konami VRC7",this.chips=[new U]}}t.FurnaceSystemVRC7=y;class U{constructor(){this.chipId=r.Ricoh2A03,this.channels=[{longname:"FM 1",shortname:"F1"},{longname:"FM 2",shortname:"F2"},{longname:"FM 3",shortname:"F3"},{longname:"FM 4",shortname:"F4"},{longname:"FM 5",shortname:"F5"},{longname:"FM 6",shortname:"F6"}],this.volume=64,this.panning=0,this.flags=0}}t.FurnaceChipVRC7=U},235:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.defaultFlags=t.defaults=void 0,t.defaults={version:96,toolName:"furnace-module-interface",toolVersion:"0.1.0",author:"default author",songName:"default name",gameName:"default game",systemName:"default system",songComment:"default comment",moduleName:"default name",moduleComment:"default comment",timebase:0,speed1:6,speed2:6,highlightA:4,highlightB:16,tempo:150,tps:60,rows:64,A4Tuning:440,effects:1,masterVolume:1,instrumentName:"default name",sampleName:"default name",sampleRate:22050,wavetableName:"default name",wavetableMax:0,wavetableMin:0,patternName:"default name",fmInsData:[0,0,0,0,4,0,0,0],fmInsOpData:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],gbInsData:[0,0,0,0],gbExtraInsData:[0,0],gbEnvSeq:[],c64InsData:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],amigaInsData:[0,0,0],oplDrumsModeData:[0,0,0,0],namco163InsData:[0,0,0,0],fdsInsData:[0,0,0],fdsModTable:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],opzInsData:[0,0],wavetableSynthInsData:[0,0,0,0,0,0,0,0,0,0,0],multipcmInsData:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],tsuInsData:[0,0]},t.defaultFlags={}},770:function(e,t,a){var r=this&&this.__createBinding||(Object.create?function(e,t,a,r){void 0===r&&(r=a);var n=Object.getOwnPropertyDescriptor(t,a);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[a]}}),Object.defineProperty(e,r,n)}:function(e,t,a,r){void 0===r&&(r=a),e[r]=t[a]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)"default"!==a&&Object.prototype.hasOwnProperty.call(e,a)&&r(t,e,a);return n(t,e),t},o=this&&this.__exportStar||function(e,t){for(var a in e)"default"===a||Object.prototype.hasOwnProperty.call(t,a)||r(t,e,a)},i=this&&this.__awaiter||function(e,t,a,r){return new(a||(a=Promise))((function(n,s){function o(e){try{l(r.next(e))}catch(e){s(e)}}function i(e){try{l(r.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(o,i)}l((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.getEffectName=t.getVersionString=t.loadFurnaceModule=t.inflateBuffer=t.deflateBuffer=t.FurnaceWavetableModule=t.FurnaceSongModule=t.FurnaceInstrumentModule=void 0;const l=a(548);Object.defineProperty(t,"FurnaceInstrumentModule",{enumerable:!0,get:function(){return l.FurnaceInstrumentModule}});const c=a(441);Object.defineProperty(t,"FurnaceSongModule",{enumerable:!0,get:function(){return c.FurnaceSongModule}});const h=a(676);Object.defineProperty(t,"FurnaceWavetableModule",{enumerable:!0,get:function(){return h.FurnaceWavetableModule}});const u=s(a(796)),m=a(817);o(a(61),t),o(a(596),t),o(a(470),t),o(a(433),t),o(a(718),t),o(a(525),t),o(a(762),t),o(a(360),t),o(a(262),t),o(a(154),t);const f=a(596);function p(e){return new Promise(((t,a)=>{u.inflate(e,((e,r)=>{e&&a(e),t(r)}))}))}t.deflateBuffer=function(e){return new Promise(((t,a)=>{u.deflate(e,((e,r)=>{e&&a(e),t(r)}))}))},t.inflateBuffer=p,t.loadFurnaceModule=function(e,t){return i(this,void 0,void 0,(function*(){let a=e;if(!1!==t){let r;try{r=yield p(e)}catch(e){if(!0===t)throw e}r&&(a=r)}return function(e){const t=e.getASCII(16,0);switch(e.setPosition(e.getPosition(-16)),t){case c.FurnaceSongModule.magic:return c.FurnaceSongModule.fromHelper(e);case l.FurnaceInstrumentModule.magic:return l.FurnaceInstrumentModule.fromHelper(e);case h.FurnaceWavetableModule.magic:return h.FurnaceWavetableModule.fromHelper(e)}throw new Error("Unable to determine module type!")}(new m.BufferReadHelper(a))}))},t.getVersionString=function(e){return d[e]||(Math.round(e)===e&&e>=57&&e<=99?"dev"+e:void 0)};const d={12:"0.2",13:"0.2.1",14:"0.2.2",15:"0.3",16:"0.3.1",17:"0.4pre1",18:"0.4pre2",19:"0.4pre3",20:"0.4",21:"0.4.1",22:"0.4.2",23:"0.4.3",24:"0.4.4",25:"0.4.5",26:"0.4.6pre1",27:"0.4.6",35:"0.5",36:"0.5.1",37:"0.5.2pre1",38:"0.5.2pre2",39:"0.5.2pre3",40:"0.5.2",41:"0.5.3",42:"0.5.4",43:"0.5.5pre1",44:"0.5.5pre2",45:"0.5.5pre3",46:"0.5.5",47:"0.5.6pre1",48:"0.5.6",49:"0.5.7pre1",50:"0.5.7pre2",51:"0.5.7pre3",52:"0.5.7pre4",53:"0.5.7",54:"0.5.8",75:"0.6pre0/April Fools",100:"0.6pre1",101:"0.6pre1",102:"0.6pre1"};t.getEffectName=function(e,t){let a=g[t];if(a)return a;switch(e){case f.FurnaceSystemEnum.YM2612:case f.FurnaceSystemEnum.YM2612Extended:a=v[t];break;case f.FurnaceSystemEnum.Genesis:case f.FurnaceSystemEnum.GenesisExtended:a=v[t]||w[t];break;case f.FurnaceSystemEnum.SMS:a=w[t]}return a||{parameters:[]}};const g={144:{minversion:12,format:"9xxx",name:"Sample offset",parameters:[{xxx:"Sample offset = xxx*256"}]},145:{minversion:12,format:"9xxx",name:"Sample offset",parameters:[{xxx:"Sample offset = xxx*256"}]},146:{minversion:12,format:"9xxx",name:"Sample offset",parameters:[{xxx:"Sample offset = xxx*256"}]},147:{minversion:12,format:"9xxx",name:"Sample offset",parameters:[{xxx:"Sample offset = xxx*256"}]},148:{minversion:12,format:"9xxx",name:"Sample offset",parameters:[{xxx:"Sample offset = xxx*256"}]},149:{minversion:12,format:"9xxx",name:"Sample offset",parameters:[{xxx:"Sample offset = xxx*256"}]},150:{minversion:12,format:"9xxx",name:"Sample offset",parameters:[{xxx:"Sample offset = xxx*256"}]},151:{minversion:12,format:"9xxx",name:"Sample offset",parameters:[{xxx:"Sample offset = xxx*256"}]},152:{minversion:12,format:"9xxx",name:"Sample offset",parameters:[{xxx:"Sample offset = xxx*256"}]},153:{minversion:12,format:"9xxx",name:"Sample offset",parameters:[{xxx:"Sample offset = xxx*256"}]},154:{minversion:12,format:"9xxx",name:"Sample offset",parameters:[{xxx:"Sample offset = xxx*256"}]},155:{minversion:12,format:"9xxx",name:"Sample offset",parameters:[{xxx:"Sample offset = xxx*256"}]},156:{minversion:12,format:"9xxx",name:"Sample offset",parameters:[{xxx:"Sample offset = xxx*256"}]},157:{minversion:12,format:"9xxx",name:"Sample offset",parameters:[{xxx:"Sample offset = xxx*256"}]},159:{minversion:12,format:"9xxx",name:"Sample offset",parameters:[{xxx:"Sample offset = xxx*256"}]},192:{minversion:12,format:"Cxxx",name:"Set Tick Rate",parameters:[{xxx:"Tick rate in hz = xxx. Minimum = 10, maximum = 3FF"}]},193:{minversion:12,format:"Cxxx",name:"Set Tick Rate",parameters:[{xxx:"Tick rate in hz = xxx. Minimum = 10, maximum = 3FF"}]},194:{minversion:12,format:"Cxxx",name:"Set Tick Rate",parameters:[{xxx:"Tick rate in hz = xxx. Minimum = 10, maximum = 3FF"}]},195:{minversion:12,format:"Cxxx",name:"Set Tick Rate",parameters:[{xxx:"Tick rate in hz = xxx. Minimum = 10, maximum = 3FF"}]},240:{minversion:12,format:"F0xx",name:"Set Tick Rate",parameters:[{xxx:"Tick rate in bpm = xx"}]},0:{minversion:12,format:"00xy",name:"Arpeggio",parameters:[{x:"Semitone offset 1",y:"Semitone offset 2"}]},224:{minversion:12,format:"E0xx",name:"Arpeggio Speed",parameters:[{xx:"The number of ticks between arpeggio change"}]},1:{minversion:12,format:"01xx",name:"Pitch Slide Up",parameters:[{xx:"Speed of the slide"}]},2:{minversion:12,format:"02xx",name:"Pitch Slide Down",parameters:[{xx:"Speed of the slide"}]},3:{minversion:12,format:"03xx",name:"Portamento",parameters:[{xx:"Speed of the portamento"}]},225:{minversion:12,format:"E1xy",name:"Note Slide Up",parameters:[{x:"Speed of the slide",y:"Number of semitones to slide"}]},226:{minversion:12,format:"E2xy",name:"Note Slide Down",parameters:[{x:"Speed of the slide",y:"Number of semitones to slide"}]},241:{minversion:12,format:"F1xx",name:"Pitch Slide Up",explanation:"Single tick variant",parameters:[{xx:"Speed of the slide"}]},242:{minversion:12,format:"F2xx",name:"Pitch Slide Down",explanation:"Single tick variant",parameters:[{xx:"Speed of the slide"}]},10:{minversion:12,format:"0Axy",name:"Volume Slide",parameters:[{x0:"slide up speed","0y":"slide down speed"}]},250:{minversion:12,format:"FAxy",name:"Volume Slide",explanation:"4x faster variant",parameters:[{x0:"slide up","0y":"slide down"}]},243:{minversion:12,format:"F3xx",name:"Fine Volume Slide Up",parameters:[{xx:"speed"}]},244:{minversion:12,format:"F4xx",name:"Fine Volume Slide Down",parameters:[{xx:"speed"}]},248:{minversion:12,format:"F8xx",name:"Fine Volume Slide Up",explanation:"single tick variant",parameters:[{xx:"speed"}]},249:{minversion:12,format:"F9xx",name:"Fine Volume Slide Down",explanation:"single tick variant",parameters:[{xx:"speed"}]},4:{minversion:12,format:"04xy",name:"Vibrato",parameters:[{x:"speed",y:"depth"}]},228:{minversion:12,format:"E4xx",name:"Vibrato Range",parameters:[{xx:"range in 1/16th of a semitone"}]},227:{minversion:12,format:"E3xx",name:"Vibrato Shape",parameters:[{xx:"0 = sine up/down, 1 = sine up/0, 2 = sine 0/down"}]},7:{minversion:12,format:"07xy",name:"Tremolo",parameters:[{x:"speed",y:"depth"}]},8:{minversion:12,format:"08xy",name:"Set Panning",parameters:[{x:"left",y:"right"}]},128:{minversion:12,format:"80xx",name:"Set Panning",parameters:[{xx:"00 = left, 80 = center, FF = right"}]},129:{minversion:12,format:"81xx",name:"Set Panning",explanation:"Left channel panning",parameters:[]},130:{minversion:12,format:"82xx",name:"Set Panning",explanation:"Right channel panning",parameters:[]},9:{minversion:12,format:"09xx",name:"Set Speed 1",parameters:[]},15:{minversion:12,format:"0Fxx",name:"Set Speed 2",parameters:[]},11:{minversion:12,format:"0Bxx",name:"Jump To Pattern",parameters:[]},13:{minversion:12,format:"0Dxx",name:"Jump To Next Pattern Row",parameters:[]},255:{minversion:12,format:"FFxx",name:"Stop Song",parameters:[]},12:{minversion:12,format:"0Cxx",name:"Retrigger",parameters:[]},236:{minversion:12,format:"ECxx",name:"Note Cut",parameters:[]},237:{minversion:12,format:"EDxx",name:"Note Delay",parameters:[]},234:{minversion:12,format:"EAxx",name:"Legato",parameters:[{xx:"0 = disabled"}]},229:{minversion:12,format:"E5xx",name:"Set Pitch",parameters:[{xx:"80 = center, FF = ~1 semitone, 00 = ~-1 semitone"}]},239:{minversion:12,format:"EFxx",name:"Set Global Pitch",explanation:"Broken",parameters:[]},235:{minversion:12,format:"EBxx",name:"Set Sample Bank",parameters:[]},238:{minversion:12,format:"EExx",name:"External Command",parameters:[]}},v={23:{minversion:12,format:"17xx",name:"Enable DAC",parameters:[{xx:"00 = disabled"}]},24:{minversion:12,format:"18xx",name:"Enable Extended CH3 mode",parameters:[{xx:"00 = disabled"}]},16:{minversion:12,format:"10xy",name:"Setup LFO",parameters:[{x:"enable",y:"speed"}]},17:{minversion:12,format:"11xx",name:"Set Feedback",parameters:[{xx:"values 00 to 07 supported"}]},48:{minversion:12,format:"30xx",name:"Toggle Hard Envelope Reset",parameters:[{xx:"00 = disabled"}]},22:{minversion:12,format:"16xy",name:"Set Multiple",parameters:[{x:"values 0 to F supported",y:"operator from 1 to 4"}]},80:{minversion:12,format:"50xy",name:"Set Amplitude Modulation",parameters:[{x:"0 = disabled",y:"operator from 1 to 4, or 0 for all operators"}]},81:{minversion:12,format:"51xy",name:"Set Sustain Level",parameters:[{x:"values 0 to F supported",y:"operator from 1 to 4, or 0 for all operators"}]},82:{minversion:12,format:"52xy",name:"Set Release Rate",parameters:[{x:"values 0 to F supported",y:"operator from 1 to 4, or 0 for all operators"}]},83:{minversion:12,format:"53xy",name:"Set Detune",parameters:[{x:"values 0 to 7 supported, 3 = center",y:"operator from 1 to 4, or 0 for all operators"}]},84:{minversion:12,format:"54xy",name:"Set Rate Scale",parameters:[{x:"values 0 to 3 supported",y:"operator from 1 to 4, or 0 for all operators"}]},85:{minversion:12,format:"55xy",name:"Set SSG-EG",parameters:[{x:"values 0 to 7 = envelope enabled, 8 - F = envelope disabled",y:"operator from 1 to 4, or 0 for all operators"}]},18:{minversion:12,format:"12xx",name:"Set Total Level Of Operator 1",parameters:[{xx:"values 00 (highest) to 7F (lowest) supported"}]},19:{minversion:12,format:"13xx",name:"Set Total Level Of Operator 2",parameters:[{xx:"values 00 (highest) to 7F (lowest) supported"}]},20:{minversion:12,format:"14xx",name:"Set Total Level Of Operator 3",parameters:[{xx:"values 00 (highest) to 7F (lowest) supported"}]},21:{minversion:12,format:"15xx",name:"Set Total Level Of Operator 4",parameters:[{xx:"values 00 (highest) to 7F (lowest) supported"}]},25:{minversion:12,format:"19xx",name:"Set Attack Rate All Operators",parameters:[{xx:"values 00 to 1F supported"}]},26:{minversion:12,format:"1Axx",name:"Set Attack Rate Of Operator 1",parameters:[{xx:"values 00 to 1F supported"}]},27:{minversion:12,format:"1Bxx",name:"Set Attack Rate Of Operator 2",parameters:[{xx:"values 00 to 1F supported"}]},28:{minversion:12,format:"1Cxx",name:"Set Attack Rate Of Operator 3",parameters:[{xx:"values 00 to 1F supported"}]},29:{minversion:12,format:"1Dxx",name:"Set Attack Rate Of Operator 4",parameters:[{xx:"values 00 to 1F supported"}]},86:{minversion:12,format:"56xx",name:"Set Decay 1 Rate All Operators",parameters:[{xx:"values 00 to 1F supported"}]},87:{minversion:12,format:"57xx",name:"Set Decay 1 Rate Of Operator 1",parameters:[{xx:"values 00 to 1F supported"}]},88:{minversion:12,format:"58xx",name:"Set Decay 1 Rate Of Operator 2",parameters:[{xx:"values 00 to 1F supported"}]},89:{minversion:12,format:"59xx",name:"Set Decay 1 Rate Of Operator 3",parameters:[{xx:"values 00 to 1F supported"}]},90:{minversion:12,format:"5Axx",name:"Set Decay 1 Rate Of Operator 4",parameters:[{xx:"values 00 to 1F supported"}]},91:{minversion:12,format:"5Bxx",name:"Set Decay 2 Rate All Operators",parameters:[{xx:"values 00 to 1F supported"}]},92:{minversion:12,format:"5Cxx",name:"Set Decay 2 Rate Of Operator 1",parameters:[{xx:"values 00 to 1F supported"}]},93:{minversion:12,format:"5Dxx",name:"Set Decay 2 Rate Of Operator 2",parameters:[{xx:"values 00 to 1F supported"}]},94:{minversion:12,format:"5Exx",name:"Set Decay 2 Rate Of Operator 3",parameters:[{xx:"values 00 to 1F supported"}]},95:{minversion:12,format:"5Fxx",name:"Set Decay 2 Rate Of Operator 4",parameters:[{xx:"values 00 to 1F supported"}]}},w={32:{minversion:12,format:"20xy",name:"Set Noise Mode",parameters:[{x:"0 = preset freq, 1 = ch3 freq",y:"0 = periodic, 1 = white noise"}]}}},470:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.FurnaceLoopModality=t.FurnacePitchMode=t.FurnaceInfo=void 0;const r=a(61),n=a(596),s=a(235),o=a(433),i=a(762),l=a(360),c=a(262),h=a(154);class u{constructor(){this.songs=[c.FurnaceSong.create()],this.systems=[],this.metadata={songName:s.defaults.moduleName,songAuthor:s.defaults.author,systemName:s.defaults.systemName,gameName:s.defaults.gameName},this.metadataJP={songName:s.defaults.moduleName,songAuthor:s.defaults.author,systemName:s.defaults.systemName,gameName:s.defaults.gameName},this.A4Tuning=s.defaults.A4Tuning,this.flags=Object.assign({},s.defaultFlags),this.instruments=[],this.wavetables=[],this.samples=[],this.masterVolume=s.defaults.masterVolume,this.comment=s.defaults.moduleComment}static create(){return new u}static fromHelper(e,t){const a=u.create();if(u.magic!==e.getASCII(4))throw new Error('Expected format magic string "'+u.magic+'" when loading the info block.');e.skipBytes(4),a.songs[0].timebase=e.readUInt8()+1,a.songs[0].speed1=e.readUInt8(),a.songs[0].speed2=e.readUInt8(),a.songs[0].initialArpeggioTime=e.readUInt8(),a.songs[0].ticksPerSecond=e.readFloat32LE(),a.songs[0].rows=e.readUInt16LE();const s=e.readUInt16LE();if(a.songs[0].rows>256)throw new Error("Expected at most 256 rows in a pattern, but "+a.songs[0].rows+" were loaded.");if(s>(t<80?127:256))throw new Error("Expected at most "+(t<80?127:256)+" orders in the main song, but "+s+" were loaded.");a.songs[0].highlightA=e.readUInt8(),a.songs[0].highlightB=e.readUInt8();const m=e.readUInt16LE(),f=e.readUInt16LE(),p=e.readUInt16LE(),d=e.readUInt32LE();if(m>256)throw new Error("Expected at most 256 instruments in module, but "+m+" were loaded.");if(f>256)throw new Error("Expected at most 256 wavetables in module, but "+f+" were loaded.");if(p>256)throw new Error("Expected at most 256 samples in module, but "+p+" were loaded.");const g=new Array(32);let v=0;for(let t=0;t<32;t++){const r=(0,n.loadSystem)(e.readUInt8());if(null===r){e.skipBytes(31-t);break}a.systems[t]=r;for(const e of r.chips){if(v>=32)throw new Error("Expected at most 32 chips in module!");g[v++]=e}}for(let t=0;t<32;t++){const a=e.readUInt8();g[t]&&(g[t].volume=a)}for(let t=0;t<32;t++){const a=e.readUInt8();g[t]&&(g[t].panning=a)}for(let t=0;t<32;t++){const a=e.readUInt32LE();g[t]&&(g[t].flags=a)}a.metadata.songName=e.readString("utf-8"),a.metadata.songAuthor=e.readString("utf-8"),a.A4Tuning=e.readFloat32LE();const w=a=>{const r=e.readUInt8();if(!(t<a))return r},I=a=>{const r=e.readUInt8();if(!(t<a))return 0!==r};a.flags.limitSlides=I(36),a.flags.pitchMode=w(36),a.flags.loopModality=w(36),a.flags.properNoiseLayout=I(42),a.flags.waveDutyIsVolume=I(42),a.flags.resetMacroOnPorta=I(45),a.flags.legacyVolumeSlides=I(45),a.flags.compatibleArpeggio=I(45),a.flags.noteOffResetsSlides=I(45),a.flags.targetResetsSlides=I(45),a.flags.arpeggioInhibitsPortamento=I(47),a.flags.wackAlgorithmMacro=I(47),a.flags.brokenShortcutSlides=I(49),a.flags.ignoreDuplicateSlids=I(50),a.flags.stopPortamentoOnNoteOff=I(62),a.flags.continuousVibrato=I(62),a.flags.brokenDacMode=I(64),a.flags.oneTickCut=I(65),a.flags.instrumentChangeDuringPorta=I(66),a.flags.resetNoteBaseOnArpeggioEffectStop=I(69);const x=[],M=[],E=[],S=[];for(let t=0;t<m;t++)x.push(e.readUInt32LE());for(let t=0;t<f;t++)M.push(e.readUInt32LE());for(let t=0;t<p;t++)E.push(e.readUInt32LE());for(let t=0;t<d;t++)S.push(e.readUInt32LE());if(a.songs[0].fetchChannels(e,t,(0,r.computeChannelCount)(a),s),a.comment=e.readString("utf-8"),a.masterVolume=t<59?2:e.readFloat32LE(),t>=70&&(a.flags.brokenSpeedSelection=I(70),a.flags.noSlideOnFirstTick=I(71),a.flags.nextRowResetArpPos=I(71),a.flags.ignoreJumpAtEnd=I(71),a.flags.buggyPortaAfterSlide=I(72),a.flags.newInsAffectsEnvelope=I(72),a.flags.extChStateIsShared=I(78),a.flags.ignoreDacOutsideOfCh=I(83),a.flags.E1xxE2xxPriorityOverSlide00=I(83),a.flags.newSegaPCM=I(84),a.flags.weirdFnumSlides=I(85),a.flags.SNDutyMacroAlwaysResetsPhase=I(86),a.flags.pitchMacroIsLinear=I(90),a.flags.pitchSlideSpeedInFullLinear=w(94),a.flags.oldFMOctaveBehavior=I(97),a.flags.disableDACVolume=I(98),a.flags.newVolumeScaling=I(99),a.flags.volumeMacroIsHeld=I(99),a.flags.brokenOutVol=I(99),a.flags.slideStopsOnRepeatedNote=I(100),a.flags.brokenPortaPositionAfterArp=I(101),e.skipBytes(7)),t<96?e.skipBytes(4):(a.songs[0].virtualTempoNumerator=e.readUInt16LE(),a.songs[0].virtualTempoDenominator=e.readUInt16LE()),t>=95){a.songs[0].name=e.readString("utf-8"),a.songs[0].comment=e.readString("utf-8");const r=e.readUInt8();e.skipBytes(3);const n=[];for(let t=0;t<r;t++)n.push(e.readUInt32LE());a.songs.push(...n.map((r=>{const n=e.getPosition(0);e.setPosition(r);const s=c.FurnaceSong.fromHelper(e,a,t);return e.setPosition(n),s})))}else a.songs[0].name=a.metadata.songName,a.songs[0].comment=a.comment;return t>=103&&(a.metadata.systemName=e.readString("utf-8"),a.metadata.gameName=e.readString("utf-8"),a.metadataJP.songName=e.readString("utf-8"),a.metadataJP.songAuthor=e.readString("utf-8"),a.metadataJP.systemName=e.readString("utf-8"),a.metadataJP.gameName=e.readString("utf-8")),a.instruments=x.map((t=>{const a=e.getPosition(0);e.setPosition(t);const r=o.FurnaceInstrument.fromHelper(e);return e.setPosition(a),r})),a.wavetables=M.map((t=>{const a=e.getPosition(0);e.setPosition(t);const r=h.FurnaceWavetable.fromHelper(e);return e.setPosition(a),r})),a.samples=E.map((a=>{const r=e.getPosition(0);e.setPosition(a);const n=l.FurnaceSample.fromHelper(e,t);return e.setPosition(r),n})),S.forEach((r=>{const n=e.getPosition(0);e.setPosition(r);const s=i.FurnacePattern.fromHelper(e,t),o=a.songs[s.song];if(!o)throw new Error("Pattern can not be loaded at song id "+s.song.toString(16)+" because it does not exist!");const l=o.channelInfo[s.channel];if(!l)throw new Error("Pattern can not be loaded at song id "+s.song.toString(16)+" channel id "+s.channel+" because it does not exist!");if(s.index>256)throw new Error("Pattern can not be loaded at index "+s.index.toString(16)+" because it's'invalid!");l.patterns[s.index]=s.pattern,s.pattern.loadData(e,t,o.rows,l.effects),e.setPosition(n)})),a}writeToBuffer(e,t){var a,r;const n=e.getPosition(8);e.writeString(u.magic,"ascii",!1),e.skipBytes(4),e.writeUInt8(this.songs[0].timebase-1),e.writeUInt8(this.songs[0].speed1),e.writeUInt8(this.songs[0].speed2),e.writeUInt8(this.songs[0].initialArpeggioTime),e.writeFloat32LE(this.songs[0].ticksPerSecond),e.writeUInt16LE(this.songs[0].rows),e.writeUInt16LE(this.songs[0].channelInfo[0].orders.length),e.writeUInt8(this.songs[0].highlightA),e.writeUInt8(this.songs[0].highlightB);const s=[];this.songs.forEach(((e,t)=>{e.channelInfo.forEach(((e,a)=>{e.patterns.forEach(((e,r)=>{e&&s.push({song:t,channel:a,index:r,pattern:e})}))}))})),e.writeUInt16LE(this.instruments.length),e.writeUInt16LE(this.wavetables.length),e.writeUInt16LE(this.samples.length),e.writeUInt32LE(s.length);const o=new Array(32).fill(null),i=new Array(32).fill(0);let l=0;for(let e=0;e<32;e++){const t=this.systems[e];if(!t)break;i[e]=t.systemId;for(const e of t.chips){if(l>=32)throw new Error("Expected at most 32 chips in module!");o[l++]=e}}e.writeBuffer(Buffer.from(i),0,32),e.writeBuffer(Buffer.from(o.map((e=>{var t;return null!==(t=null==e?void 0:e.volume)&&void 0!==t?t:64}))),0,32),e.writeBuffer(Buffer.from(o.map((e=>{var t;return null!==(t=null==e?void 0:e.panning)&&void 0!==t?t:0}))),0,32);for(let t=0;t<32;t++)e.writeUInt32LE(null!==(r=null===(a=o[t])||void 0===a?void 0:a.flags)&&void 0!==r?r:0);e.writeString(this.metadata.songName,"utf-8",!0),e.writeString(this.metadata.songAuthor,"utf-8",!0),e.writeFloat32LE(this.A4Tuning);const c=(a,r)=>{e.writeUInt8(t<a?0:null!=r?r:0)},h=(a,r)=>{e.writeUInt8(t<a||!0!==r?0:1)};h(36,this.flags.limitSlides),c(36,this.flags.pitchMode),c(36,this.flags.loopModality),h(42,this.flags.properNoiseLayout),h(42,this.flags.waveDutyIsVolume),h(45,this.flags.resetMacroOnPorta),h(45,this.flags.legacyVolumeSlides),h(45,this.flags.compatibleArpeggio),h(45,this.flags.noteOffResetsSlides),h(45,this.flags.targetResetsSlides),h(47,this.flags.arpeggioInhibitsPortamento),h(47,this.flags.wackAlgorithmMacro),h(49,this.flags.brokenShortcutSlides),h(50,this.flags.ignoreDuplicateSlids),h(62,this.flags.stopPortamentoOnNoteOff),h(62,this.flags.continuousVibrato),h(64,this.flags.brokenDacMode),h(65,this.flags.oneTickCut),h(66,this.flags.instrumentChangeDuringPorta),h(69,this.flags.resetNoteBaseOnArpeggioEffectStop);const m=e.getPosition(0);e.skipBytes(4*this.instruments.length);const f=e.getPosition(0);e.skipBytes(4*this.wavetables.length);const p=e.getPosition(0);e.skipBytes(4*this.samples.length);const d=e.getPosition(0);e.skipBytes(4*s.length),this.songs[0].writeChannels(e),e.writeString(this.comment,"ascii",!0),t>=59&&e.writeFloat32LE(this.masterVolume),t>=70&&(h(70,this.flags.brokenSpeedSelection),h(71,this.flags.noSlideOnFirstTick),h(71,this.flags.nextRowResetArpPos),h(71,this.flags.ignoreJumpAtEnd),h(72,this.flags.buggyPortaAfterSlide),h(72,this.flags.newInsAffectsEnvelope),h(78,this.flags.extChStateIsShared),h(83,this.flags.ignoreDacOutsideOfCh),h(83,this.flags.E1xxE2xxPriorityOverSlide00),h(84,this.flags.newSegaPCM),h(85,this.flags.weirdFnumSlides),h(86,this.flags.SNDutyMacroAlwaysResetsPhase),h(90,this.flags.pitchMacroIsLinear),c(94,this.flags.pitchSlideSpeedInFullLinear),h(97,this.flags.oldFMOctaveBehavior),h(98,this.flags.disableDACVolume),h(99,this.flags.newVolumeScaling),h(99,this.flags.volumeMacroIsHeld),h(99,this.flags.brokenOutVol),h(100,this.flags.slideStopsOnRepeatedNote),h(101,this.flags.brokenPortaPositionAfterArp),e.skipBytes(9)),t>=96?(e.writeUInt16LE(this.songs[0].virtualTempoNumerator),e.writeUInt16LE(this.songs[0].virtualTempoDenominator)):t>=70&&e.skipBytes(4);let g=0;t>=95&&(e.writeString(this.songs[0].name,"utf-8",!0),e.writeString(this.songs[0].comment,"utf-8",!0),e.writeUInt8(this.songs.length-1),e.skipBytes(3),g=e.getPosition(0),e.skipBytes(4*(this.songs.length-1))),t>=103&&(e.writeString(this.metadata.systemName,"utf-8",!0),e.writeString(this.metadata.gameName,"utf-8",!0),e.writeString(this.metadataJP.songName,"utf-8",!0),e.writeString(this.metadataJP.songAuthor,"utf-8",!0),e.writeString(this.metadataJP.systemName,"utf-8",!0),e.writeString(this.metadataJP.gameName,"utf-8",!0)),e.writeUInt32LE(e.getPosition()-n,n-4),this.songs.forEach(((t,a)=>{0!==a&&(e.writeUInt32LE(e.getPosition(0),g+4*(a-1)),t.writeToBuffer(e))})),this.instruments.forEach(((t,a)=>{e.writeUInt32LE(e.getPosition(0),m+4*a),t.writeToBuffer(e)})),this.wavetables.forEach(((t,a)=>{e.writeUInt32LE(e.getPosition(0),f+4*a),t.writeToBuffer(e)})),this.samples.forEach(((a,r)=>{e.writeUInt32LE(e.getPosition(0),p+4*r),a.writeToBuffer(e,t)})),s.forEach(((a,r)=>{e.writeUInt32LE(e.getPosition(0),d+4*r),a.pattern.writeToBuffer(e,t,a.channel,a.index,a.song)}))}}var m,f;t.FurnaceInfo=u,u.magic="INFO",(f=t.FurnacePitchMode||(t.FurnacePitchMode={}))[f.nonLinear=0]="nonLinear",f[f.partialLinear=1]="partialLinear",f[f.fullLinear=2]="fullLinear",(m=t.FurnaceLoopModality||(t.FurnaceLoopModality={}))[m.item0=0]="item0",m[m.item1=1]="item1",m[m.item2=2]="item2"},433:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.FurnaceInstrumentViewAmiga=t.FurnaceAmigaModeEnum=t.FurnaceInstrumentViewOpOPNOPM=t.FurnaceInstrumentViewOPNOPM=t.FurnaceInstrumentViewStandard=t.FurnaceInstrument=t.FurnaceInstrumentTypeEnum=void 0;const r=a(235),n=a(718);var s;!function(e){e[e.Standard=0]="Standard",e[e.OPMOPN=1]="OPMOPN",e[e.GameBoy=2]="GameBoy",e[e.C64=3]="C64",e[e.Amiga=4]="Amiga",e[e.PCEngine=5]="PCEngine",e[e.AY38910=6]="AY38910",e[e.AY8930=7]="AY8930",e[e.TIA=8]="TIA",e[e.SAA1099=9]="SAA1099",e[e.VIC=10]="VIC",e[e.PET=11]="PET",e[e.VRC6=12]="VRC6",e[e.OPLL=13]="OPLL",e[e.OPL=14]="OPL",e[e.FDS=15]="FDS",e[e.VirtualBoy=16]="VirtualBoy",e[e.Namco163=17]="Namco163",e[e.SCC=18]="SCC",e[e.OPZ=19]="OPZ",e[e.POKEY=20]="POKEY",e[e.PCSpeaker=21]="PCSpeaker",e[e.WonderSwan=22]="WonderSwan",e[e.Lynx=23]="Lynx",e[e.VERA=24]="VERA",e[e.X1010=25]="X1010",e[e.VRC6Saw=26]="VRC6Saw",e[e.E5506=27]="E5506",e[e.MultiPCM=28]="MultiPCM",e[e.SNES=29]="SNES",e[e.SoundUnit=30]="SoundUnit",e[e.NamcoWSG=31]="NamcoWSG"}(s=t.FurnaceInstrumentTypeEnum||(t.FurnaceInstrumentTypeEnum={}));class o{constructor(){var e;this.version=r.defaults.version,this.name=r.defaults.instrumentName,this.type=s.Standard,this.vars={fmInsData:Array.from(r.defaults.fmInsData),fmInsOpData:Array.from(r.defaults.fmInsOpData),gbInsData:Array.from(r.defaults.gbInsData),gbExtraInsData:Array.from(r.defaults.gbExtraInsData),c64InsData:Array.from(r.defaults.c64InsData),amigaInsData:Array.from(r.defaults.amigaInsData),oplDrumsModeData:Array.from(r.defaults.oplDrumsModeData),namco163InsData:Array.from(r.defaults.namco163InsData),fdsInsData:Array.from(r.defaults.fdsInsData),fdsModTable:Array.from(r.defaults.fdsModTable),opzInsData:Array.from(r.defaults.opzInsData),wavetableSynthInsData:Array.from(r.defaults.wavetableSynthInsData),multipcmInsData:Array.from(r.defaults.multipcmInsData),tsuInsData:Array.from(r.defaults.tsuInsData),gbEnvSeq:Array.from(r.defaults.gbEnvSeq),sampleMap:[],volumeMacro:new n.FurnaceMacroWithHeight,arpeggioMacro:new n.FurnaceArpeggioMacro,dutyMacro:new n.FurnaceMacroWithHeight,waveMacro:new n.FurnaceMacroWithHeight,pitchMacro:new n.FurnaceGenericMacro,algorithmMacro:new n.FurnaceGenericMacro,feedbackMacro:new n.FurnaceGenericMacro,fmsMacro:new n.FurnaceGenericMacro,amsMacro:new n.FurnaceGenericMacro,leftPanMacro:new n.FurnaceGenericMacro,rightPanMacro:new n.FurnaceGenericMacro,phaseResetMacro:new n.FurnaceGenericMacro,extra1Macro:new n.FurnaceGenericMacro,extra2Macro:new n.FurnaceGenericMacro,extra3Macro:new n.FurnaceGenericMacro,extra4Macro:new n.FurnaceGenericMacro,extra5Macro:new n.FurnaceGenericMacro,extra6Macro:new n.FurnaceGenericMacro,extra7Macro:new n.FurnaceGenericMacro,extra8Macro:new n.FurnaceGenericMacro,amplitudeModulationMacro:[new n.FurnaceOperatorMacro(1),new n.FurnaceOperatorMacro(3),new n.FurnaceOperatorMacro(2),new n.FurnaceOperatorMacro(4)],attackRateMaco:[new n.FurnaceOperatorMacro(1),new n.FurnaceOperatorMacro(3),new n.FurnaceOperatorMacro(2),new n.FurnaceOperatorMacro(4)],decay1RateMacro:[new n.FurnaceOperatorMacro(1),new n.FurnaceOperatorMacro(3),new n.FurnaceOperatorMacro(2),new n.FurnaceOperatorMacro(4)],multipleMacro:[new n.FurnaceOperatorMacro(1),new n.FurnaceOperatorMacro(3),new n.FurnaceOperatorMacro(2),new n.FurnaceOperatorMacro(4)],releaseRateMacro:[new n.FurnaceOperatorMacro(1),new n.FurnaceOperatorMacro(3),new n.FurnaceOperatorMacro(2),new n.FurnaceOperatorMacro(4)],decay2LevelMacro:[new n.FurnaceOperatorMacro(1),new n.FurnaceOperatorMacro(3),new n.FurnaceOperatorMacro(2),new n.FurnaceOperatorMacro(4)],totalLevelMacro:[new n.FurnaceOperatorMacro(1),new n.FurnaceOperatorMacro(3),new n.FurnaceOperatorMacro(2),new n.FurnaceOperatorMacro(4)],detune2Macro:[new n.FurnaceOperatorMacro(1),new n.FurnaceOperatorMacro(3),new n.FurnaceOperatorMacro(2),new n.FurnaceOperatorMacro(4)],rateScaleMacro:[new n.FurnaceOperatorMacro(1),new n.FurnaceOperatorMacro(3),new n.FurnaceOperatorMacro(2),new n.FurnaceOperatorMacro(4)],detuneMacro:[new n.FurnaceOperatorMacro(1),new n.FurnaceOperatorMacro(3),new n.FurnaceOperatorMacro(2),new n.FurnaceOperatorMacro(4)],decay2RateMacro:[new n.FurnaceOperatorMacro(1),new n.FurnaceOperatorMacro(3),new n.FurnaceOperatorMacro(2),new n.FurnaceOperatorMacro(4)],ssgegMacro:[new n.FurnaceOperatorMacro(1),new n.FurnaceOperatorMacro(3),new n.FurnaceOperatorMacro(2),new n.FurnaceOperatorMacro(4)],_damMacro:[new n.FurnaceOperatorMacro(1),new n.FurnaceOperatorMacro(3),new n.FurnaceOperatorMacro(2),new n.FurnaceOperatorMacro(4)],_dvbMacro:[new n.FurnaceOperatorMacro(1),new n.FurnaceOperatorMacro(3),new n.FurnaceOperatorMacro(2),new n.FurnaceOperatorMacro(4)],_egtMacro:[new n.FurnaceOperatorMacro(1),new n.FurnaceOperatorMacro(3),new n.FurnaceOperatorMacro(2),new n.FurnaceOperatorMacro(4)],_kslMacro:[new n.FurnaceOperatorMacro(1),new n.FurnaceOperatorMacro(3),new n.FurnaceOperatorMacro(2),new n.FurnaceOperatorMacro(4)],_susMacro:[new n.FurnaceOperatorMacro(1),new n.FurnaceOperatorMacro(3),new n.FurnaceOperatorMacro(2),new n.FurnaceOperatorMacro(4)],_vibMacro:[new n.FurnaceOperatorMacro(1),new n.FurnaceOperatorMacro(3),new n.FurnaceOperatorMacro(2),new n.FurnaceOperatorMacro(4)],_wsMacro:[new n.FurnaceOperatorMacro(1),new n.FurnaceOperatorMacro(3),new n.FurnaceOperatorMacro(2),new n.FurnaceOperatorMacro(4)],_ksrMacro:[new n.FurnaceOperatorMacro(1),new n.FurnaceOperatorMacro(3),new n.FurnaceOperatorMacro(2),new n.FurnaceOperatorMacro(4)]};for(let t=0;t<120;t++)null===(e=this.vars.sampleMap)||void 0===e||e.push({frequency:0,sample:0})}static create(){return new o}static fromHelper(e){const t=o.create();if(o.magic!==e.getASCII(4))throw new Error('Expected format magic string "'+o.magic+'" when loading an instrument block.');e.skipBytes(4),t.version=e.readUInt16LE(),t.type=e.readUInt8(),e.skipBytes(1),t.name=e.readString("utf-8"),t.vars.fmInsData=[...e.readBuffer(r.defaults.fmInsData.length)],t.vars.fmInsOpData=[...e.readBuffer(r.defaults.fmInsOpData.length)],t.vars.gbInsData=[...e.readBuffer(r.defaults.gbInsData.length)],t.vars.c64InsData[0]=e.readUInt8(),t.vars.c64InsData[1]=e.readUInt8(),t.vars.c64InsData[2]=e.readUInt8(),t.vars.c64InsData[3]=e.readUInt8(),t.vars.c64InsData[4]=e.readUInt8(),t.vars.c64InsData[5]=e.readUInt8(),t.vars.c64InsData[6]=e.readUInt8(),t.vars.c64InsData[7]=e.readUInt8(),t.vars.c64InsData[8]=e.readUInt16LE(),t.vars.c64InsData[9]=e.readUInt8(),t.vars.c64InsData[10]=e.readUInt8(),t.vars.c64InsData[11]=e.readUInt8(),t.vars.c64InsData[12]=e.readUInt8(),t.vars.c64InsData[13]=e.readUInt8(),t.vars.c64InsData[14]=e.readUInt8(),t.vars.c64InsData[15]=e.readUInt8(),t.vars.c64InsData[16]=e.readUInt8(),t.vars.c64InsData[17]=e.readUInt8(),t.vars.c64InsData[18]=e.readUInt8(),t.vars.c64InsData[19]=e.readUInt16LE(),t.vars.c64InsData[20]=e.readUInt8(),t.vars.c64InsData[21]=e.readUInt8(),t.vars.amigaInsData[0]=e.readUInt16LE(),t.vars.amigaInsData[2]=e.readUInt8(),t.vars.amigaInsData[3]=e.readUInt8(),e.skipBytes(12);const a=()=>{const t=e.readUInt32LE();return 4294967295!==t?t:null},n=()=>0!==e.readUInt8(),s=t=>{const a=[];for(let r=0;r<t;r++)a.push(e.readInt32LE());return a},m=t=>{const a=[];for(let r=0;r<t;r++)a.push(e.readUInt8());return a},f={};if(i.forEach((t=>f[t]=e.readUInt32LE())),i.forEach((e=>t.vars[e].loop=a())),t.vars.arpeggioMacro.isAbsolute=0!==e.readUInt8(),e.skipBytes(3),t.version<17&&(t.vars.pitchMacro=null,t.vars.extra1Macro=null,t.vars.extra2Macro=null,t.vars.extra3Macro=null),15!==t.version&&16!==t.version&&(t.vars.volumeMacro.height=null,t.vars.dutyMacro.height=null,t.vars.waveMacro.height=null),t.version<31&&(t.vars.arpeggioMacro.valueOffset=12),i.forEach((e=>{t.vars[e]&&(t.vars[e].data=s(f[e]))})),t.version<29)c.forEach((e=>t.vars[e]=null)),h.forEach((e=>t.vars[e]=null));else{c.forEach((t=>f[t]=e.readUInt32LE())),c.forEach((e=>t.vars[e].loop=a())),i.forEach((e=>t.vars[e].open=n())),c.forEach((e=>t.vars[e].open=n())),c.forEach((e=>t.vars[e].data=s(f[e])));for(let r=0;r<4;r++)h.forEach((t=>f[t+"_"+r]=e.readUInt32LE())),h.forEach((e=>t.vars[e][r].loop=a())),h.forEach((e=>t.vars[e][r].open=n()));for(let e=0;e<4;e++)h.forEach((a=>t.vars[a][e].data=m(f[a+"_"+e])))}if(t.version>=44){i.forEach((e=>t.vars[e].release=a())),c.forEach((e=>t.vars[e].release=a()));for(let e=0;e<4;e++)h.forEach((r=>t.vars[r][e].release=a()))}if(t.version<61)u.forEach((e=>t.vars[e]=null));else{for(let r=0;r<4;r++)u.forEach((t=>f[t+"_"+r]=e.readUInt32LE())),u.forEach((e=>t.vars[e][r].loop=a())),u.forEach((e=>t.vars[e][r].release=a())),u.forEach((e=>t.vars[e][r].open=n()));for(let e=0;e<4;e++)u.forEach((a=>t.vars[a][e].data=m(f[a+"_"+e])))}if(t.version>=63&&(t.vars.oplDrumsModeData[0]=e.readUInt8(),e.skipBytes(1),t.vars.oplDrumsModeData[1]=e.readUInt16LE(),t.vars.oplDrumsModeData[2]=e.readUInt16LE(),t.vars.oplDrumsModeData[3]=e.readUInt16LE()),t.version<67||0===e.readUInt8())t.vars.sampleMap=null;else{for(let a=0;a<120;a++)t.vars.sampleMap[a].frequency=e.readUInt32LE();for(let a=0;a<120;a++)t.vars.sampleMap[a].sample=e.readUInt16LE()}if(t.version>=73&&(t.vars.namco163InsData[0]=e.readUInt32LE(),t.vars.namco163InsData[1]=e.readUInt8(),t.vars.namco163InsData[2]=e.readUInt8(),t.vars.namco163InsData[3]=e.readUInt8(),e.skipBytes(1)),t.version<76?l.forEach((e=>t.vars[e]=null)):(l.forEach((t=>f[t]=e.readUInt32LE())),l.forEach((e=>t.vars[e].loop=a())),l.forEach((e=>t.vars[e].release=a())),l.forEach((e=>t.vars[e].open=n())),l.forEach((e=>t.vars[e].data=s(f[e]))),t.vars.fdsInsData[0]=e.readUInt32LE(),t.vars.fdsInsData[1]=e.readUInt32LE(),t.vars.fdsInsData[2]=e.readUInt8(),e.skipBytes(3),t.vars.fdsModTable=[...e.readBuffer(32)]),t.version>=77&&(t.vars.opzInsData[0]=e.readUInt8(),t.vars.opzInsData[1]=e.readUInt8()),t.version>=79&&(t.vars.wavetableSynthInsData[0]=e.readUInt32LE(),t.vars.wavetableSynthInsData[1]=e.readUInt32LE(),t.vars.wavetableSynthInsData[2]=e.readUInt8(),t.vars.wavetableSynthInsData[3]=e.readUInt8(),t.vars.wavetableSynthInsData[4]=e.readUInt8(),t.vars.wavetableSynthInsData[5]=e.readUInt8(),t.vars.wavetableSynthInsData[6]=e.readUInt8(),t.vars.wavetableSynthInsData[7]=e.readUInt8(),t.vars.wavetableSynthInsData[8]=e.readUInt8(),t.vars.wavetableSynthInsData[9]=e.readUInt8(),t.vars.wavetableSynthInsData[10]=e.readUInt8()),t.version>=84&&(i.filter((e=>!e.includes("arpeggio"))).forEach((a=>t.vars[a].mode=e.readUInt8())),c.forEach((a=>t.vars[a].mode=e.readUInt8())),l.forEach((a=>t.vars[a].mode=e.readUInt8()))),t.version>=89&&(t.vars.c64InsData[22]=e.readUInt8()),t.version>=93&&(t.vars.multipcmInsData=[...e.readBuffer(r.defaults.multipcmInsData.length)]),t.version>=104&&(t.vars.tsuInsData=[...e.readBuffer(r.defaults.tsuInsData.length)]),t.version>=105){const a=3*e.readUInt8();t.vars.gbEnvSeq=[...e.readBuffer(a)]}return t.version>=106&&(t.vars.gbExtraInsData=[...e.readBuffer(r.defaults.gbExtraInsData.length)]),t}writeToBuffer(e){var t,a,r;const n=e.getPosition(8);e.writeString(o.magic,"ascii",!1),e.skipBytes(4),e.writeInt16LE(this.version),e.writeUInt8(this.type),e.skipBytes(1),e.writeString(this.name,"utf-8",!0),e.writeBuffer(Buffer.from(this.vars.fmInsData),0,this.vars.fmInsData.length),e.writeBuffer(Buffer.from(this.vars.fmInsOpData),0,this.vars.fmInsOpData.length),e.writeBuffer(Buffer.from(this.vars.gbInsData),0,this.vars.gbInsData.length),e.writeUInt8(this.vars.c64InsData[0]),e.writeUInt8(this.vars.c64InsData[1]),e.writeUInt8(this.vars.c64InsData[2]),e.writeUInt8(this.vars.c64InsData[3]),e.writeUInt8(this.vars.c64InsData[4]),e.writeUInt8(this.vars.c64InsData[5]),e.writeUInt8(this.vars.c64InsData[6]),e.writeUInt8(this.vars.c64InsData[7]),e.writeUInt16LE(this.vars.c64InsData[8]),e.writeUInt8(this.vars.c64InsData[9]),e.writeUInt8(this.vars.c64InsData[10]),e.writeUInt8(this.vars.c64InsData[11]),e.writeUInt8(this.vars.c64InsData[12]),e.writeUInt8(this.vars.c64InsData[13]),e.writeUInt8(this.vars.c64InsData[14]),e.writeUInt8(this.vars.c64InsData[15]),e.writeUInt8(this.vars.c64InsData[16]),e.writeUInt8(this.vars.c64InsData[17]),e.writeUInt8(this.vars.c64InsData[18]),e.writeUInt16LE(this.vars.c64InsData[19]),e.writeUInt8(this.vars.c64InsData[20]),e.writeUInt8(this.vars.c64InsData[21]),e.writeUInt16LE(this.vars.amigaInsData[0]),e.writeUInt8(this.vars.amigaInsData[2]),e.writeUInt8(this.vars.amigaInsData[3]),e.skipBytes(12);const s=t=>{if(t)for(let a=0;a<t.data.length;a++)e.writeInt32LE(t.data[a])};if(i.forEach((t=>e.writeUInt32LE(this.vars[t].data.length))),i.forEach((t=>{var a;return e.writeUInt32LE(null!==(a=this.vars[t].loop)&&void 0!==a?a:4294967295)})),e.writeUInt8(this.vars.arpeggioMacro.isAbsolute?1:0),e.writeUInt8(null!==(t=this.vars.volumeMacro.height)&&void 0!==t?t:0),e.writeUInt8(null!==(a=this.vars.dutyMacro.height)&&void 0!==a?a:0),e.writeUInt8(null!==(r=this.vars.waveMacro.height)&&void 0!==r?r:0),i.forEach((e=>s(this.vars[e]))),this.version>=29){c.forEach((t=>e.writeUInt32LE(this.vars[t].data.length))),c.forEach((t=>{var a;return e.writeUInt32LE(null!==(a=this.vars[t].loop)&&void 0!==a?a:4294967295)})),i.forEach((t=>e.writeUInt8(this.vars[t].open?1:0))),c.forEach((t=>e.writeUInt8(this.vars[t].open?1:0))),c.forEach((e=>s(this.vars[e])));for(let t=0;t<4;t++)h.forEach((a=>e.writeUInt32LE(this.vars[a][t].data.length))),h.forEach((a=>{var r;return e.writeUInt32LE(null!==(r=this.vars[a][t].loop)&&void 0!==r?r:4294967295)})),h.forEach((a=>e.writeUInt8(this.vars[a][t].open?1:0)));for(let e=0;e<4;e++)h.forEach((t=>s(this.vars[t][e])))}if(this.version>=44){i.forEach((t=>{var a;return e.writeUInt32LE(null!==(a=this.vars[t].release)&&void 0!==a?a:4294967295)})),c.forEach((t=>{var a;return e.writeUInt32LE(null!==(a=this.vars[t].release)&&void 0!==a?a:4294967295)}));for(let t=0;t<4;t++)h.forEach((a=>{var r;return e.writeUInt32LE(null!==(r=this.vars[a][t].release)&&void 0!==r?r:4294967295)}))}if(this.version>=61){for(let t=0;t<4;t++)u.forEach((a=>e.writeUInt32LE(this.vars[a][t].data.length))),u.forEach((a=>{var r;return e.writeUInt32LE(null!==(r=this.vars[a][t].loop)&&void 0!==r?r:4294967295)})),u.forEach((a=>{var r;return e.writeUInt32LE(null!==(r=this.vars[a][t].release)&&void 0!==r?r:4294967295)})),u.forEach((a=>e.writeUInt8(this.vars[a][t].open?1:0)));for(let e=0;e<4;e++)u.forEach((t=>s(this.vars[t][e])))}if(this.version>=63&&(e.writeUInt8(this.vars.oplDrumsModeData[0]),e.skipBytes(1),e.writeUInt16LE(this.vars.oplDrumsModeData[1]),e.writeUInt16LE(this.vars.oplDrumsModeData[2]),e.writeUInt16LE(this.vars.oplDrumsModeData[3])),this.version<67||null===this.vars.sampleMap)e.writeUInt8(0);else{e.writeUInt8(1);for(let t=0;t<120;t++)e.writeUInt32LE(this.vars.sampleMap[t].frequency);for(let t=0;t<120;t++)e.writeUInt16LE(this.vars.sampleMap[t].sample)}this.version>=73&&(e.writeUInt32LE(this.vars.namco163InsData[0]),e.writeUInt8(this.vars.namco163InsData[1]),e.writeUInt8(this.vars.namco163InsData[2]),e.writeUInt8(this.vars.namco163InsData[3]),e.skipBytes(1)),this.version>=76&&(l.forEach((t=>e.writeUInt32LE(this.vars[t].data.length))),l.forEach((t=>{var a;return e.writeUInt32LE(null!==(a=this.vars[t].loop)&&void 0!==a?a:4294967295)})),l.forEach((t=>{var a;return e.writeUInt32LE(null!==(a=this.vars[t].release)&&void 0!==a?a:4294967295)})),l.forEach((t=>e.writeUInt8(this.vars[t].open?1:0))),l.forEach((e=>s(this.vars[e]))),e.writeUInt32LE(this.vars.fdsInsData[0]),e.writeUInt32LE(this.vars.fdsInsData[1]),e.writeUInt8(this.vars.fdsInsData[2]),e.skipBytes(3),e.writeBuffer(Buffer.from(this.vars.fdsModTable),0,this.vars.fdsModTable.length)),this.version>=77&&(e.writeUInt8(this.vars.opzInsData[0]),e.writeUInt8(this.vars.opzInsData[1])),this.version>=79&&(e.writeUInt32LE(this.vars.wavetableSynthInsData[0]),e.writeUInt32LE(this.vars.wavetableSynthInsData[1]),e.writeUInt8(this.vars.wavetableSynthInsData[2]),e.writeUInt8(this.vars.wavetableSynthInsData[3]),e.writeUInt8(this.vars.wavetableSynthInsData[4]),e.writeUInt8(this.vars.wavetableSynthInsData[5]),e.writeUInt8(this.vars.wavetableSynthInsData[6]),e.writeUInt8(this.vars.wavetableSynthInsData[7]),e.writeUInt8(this.vars.wavetableSynthInsData[8]),e.writeUInt8(this.vars.wavetableSynthInsData[9]),e.writeUInt8(this.vars.wavetableSynthInsData[10])),this.version>=84&&(i.filter((e=>!e.includes("arpeggio"))).forEach((t=>{var a;return e.writeUInt8(null!==(a=this.vars[t].mode)&&void 0!==a?a:0)})),c.forEach((t=>{var a;return e.writeUInt8(null!==(a=this.vars[t].mode)&&void 0!==a?a:0)})),l.forEach((t=>{var a;return e.writeUInt8(null!==(a=this.vars[t].mode)&&void 0!==a?a:0)}))),this.version>=89&&e.writeUInt8(this.vars.c64InsData[22]),this.version>=93&&e.writeBuffer(Buffer.from(this.vars.multipcmInsData),0,this.vars.multipcmInsData.length),this.version>=104&&e.writeBuffer(Buffer.from(this.vars.tsuInsData),0,this.vars.tsuInsData.length),this.version>=105&&(e.writeUInt8(this.vars.gbEnvSeq.length/3),e.writeBuffer(Buffer.from(this.vars.gbEnvSeq),0,this.vars.gbEnvSeq.length)),this.version>=106&&e.writeBuffer(Buffer.from(this.vars.gbExtraInsData),0,this.vars.gbExtraInsData.length),e.writeUInt32LE(e.getPosition()-n,n-4)}getView(e){var t;switch(e){case s.Standard:return new m(this.vars);case s.OPMOPN:return new f(this.vars);case s.Amiga:return new g(this.vars)}throw new Error("Unknown or unsupported instrument type id "+(null!==(t=s[e])&&void 0!==t?t:e))}getVersion(){return this.version}}t.FurnaceInstrument=o,o.magic="INST";const i=["volumeMacro","arpeggioMacro","dutyMacro","waveMacro","pitchMacro","extra1Macro","extra2Macro","extra3Macro"],l=["leftPanMacro","rightPanMacro","phaseResetMacro","extra4Macro","extra5Macro","extra6Macro","extra7Macro","extra8Macro"],c=["algorithmMacro","feedbackMacro","fmsMacro","amsMacro"],h=["amplitudeModulationMacro","attackRateMaco","decay1RateMacro","multipleMacro","releaseRateMacro","decay2LevelMacro","totalLevelMacro","detune2Macro","rateScaleMacro","detuneMacro","decay2RateMacro","ssgegMacro"],u=["_damMacro","_dvbMacro","_egtMacro","_kslMacro","_susMacro","_vibMacro","_wsMacro","_ksrMacro"];class m{constructor(e){this.vars=e,this.type=s.Standard}get volumeMacro(){return this.vars.volumeMacro}get noiseModeMacro(){return this.vars.dutyMacro}get arpeggioMacro(){return this.vars.arpeggioMacro}get pitchMacro(){return this.vars.pitchMacro}get phaseResetMacro(){return this.vars.phaseResetMacro}}t.FurnaceInstrumentViewStandard=m;class f{constructor(e){this.vars=e,this.type=s.OPMOPN,this.operators=[new p(0,0,e),new p(32,1,e),new p(64,2,e),new p(96,3,e)]}get algorithm(){return this.vars.fmInsData[0]}set algorithm(e){this.vars.fmInsData[0]=e}get feedback(){return this.vars.fmInsData[1]}set feedback(e){this.vars.fmInsData[1]=e}get fms(){return this.vars.fmInsData[2]}set fms(e){this.vars.fmInsData[2]=e}get ams(){return this.vars.fmInsData[3]}set ams(e){this.vars.fmInsData[3]=e}get operatorCount(){return this.vars.fmInsData[4]}set operatorCount(e){this.vars.fmInsData[4]=e}get volumeMacro(){return this.vars.volumeMacro}get arpeggioMacro(){return this.vars.arpeggioMacro}get pitchMacro(){return this.vars.pitchMacro}get algorithmMacro(){return this.vars.algorithmMacro}get feedbackMacro(){return this.vars.feedbackMacro}get fmsMacro(){return this.vars.fmsMacro}get amsMacro(){return this.vars.amsMacro}get hardPanMacro(){return this.vars.leftPanMacro}get phaseResetMacro(){return this.vars.phaseResetMacro}}t.FurnaceInstrumentViewOPNOPM=f;class p{constructor(e,t,a){this.offset=e,this.operator=t,this.vars=a}get amplitudeModulation(){return this.vars.fmInsOpData[this.offset+0]}set amplitudeModulation(e){this.vars.fmInsData[this.offset+0]=e}get attackRate(){return this.vars.fmInsOpData[this.offset+1]}set attackRate(e){this.vars.fmInsData[this.offset+1]=e}get decay1Rate(){return this.vars.fmInsOpData[this.offset+2]}set decay1Rate(e){this.vars.fmInsData[this.offset+2]=e}get multiple(){return this.vars.fmInsOpData[this.offset+3]}set multiple(e){this.vars.fmInsData[this.offset+3]=e}get releaseRate(){return this.vars.fmInsOpData[this.offset+4]}set releaseRate(e){this.vars.fmInsData[this.offset+4]=e}get decay1Level(){return this.vars.fmInsOpData[this.offset+5]}set decay1Level(e){this.vars.fmInsData[this.offset+5]=e}get totalLevel(){return this.vars.fmInsOpData[this.offset+6]}set totalLevel(e){this.vars.fmInsData[this.offset+6]=e}get rateScale(){return this.vars.fmInsOpData[this.offset+8]}set rateScale(e){this.vars.fmInsData[this.offset+8]=e}get detune(){return this.vars.fmInsOpData[this.offset+9]}set detune(e){this.vars.fmInsData[this.offset+9]=e}get decay2Rate(){return this.vars.fmInsOpData[this.offset+10]}set decay2Rate(e){this.vars.fmInsData[this.offset+10]=e}get ssgeg(){return this.vars.fmInsOpData[this.offset+11]}set ssgeg(e){this.vars.fmInsData[this.offset+11]=e}get amplitudeModulationMacro(){return null===this.vars.amplitudeModulationMacro?null:this.vars.amplitudeModulationMacro[this.operator]}get attackRateMaco(){return null===this.vars.attackRateMaco?null:this.vars.attackRateMaco[this.operator]}get decay1RateMacro(){return null===this.vars.decay1RateMacro?null:this.vars.decay1RateMacro[this.operator]}get multipleMacro(){return null===this.vars.multipleMacro?null:this.vars.multipleMacro[this.operator]}get releaseRateMacro(){return null===this.vars.releaseRateMacro?null:this.vars.releaseRateMacro[this.operator]}get decay2LevelMacro(){return null===this.vars.decay2LevelMacro?null:this.vars.decay2LevelMacro[this.operator]}get totalLevelMacro(){return null===this.vars.totalLevelMacro?null:this.vars.totalLevelMacro[this.operator]}get rateScaleMacro(){return null===this.vars.rateScaleMacro?null:this.vars.rateScaleMacro[this.operator]}get detuneMacro(){return null===this.vars.detuneMacro?null:this.vars.detuneMacro[this.operator]}get decay2RateMacro(){return null===this.vars.decay2RateMacro?null:this.vars.decay2RateMacro[this.operator]}get ssgegMacro(){return null===this.vars.ssgegMacro?null:this.vars.ssgegMacro[this.operator]}}var d;t.FurnaceInstrumentViewOpOPNOPM=p,(d=t.FurnaceAmigaModeEnum||(t.FurnaceAmigaModeEnum={}))[d.sample=0]="sample",d[d.wavetable=1]="wavetable";class g{constructor(e){this.vars=e,this.type=s.Amiga}get sampleId(){const e=this.vars.amigaInsData[0];return 65535===e?null:e}set sampleId(e){this.vars.amigaInsData[0]=null!=e?e:65535}get mode(){return this.vars.amigaInsData[2]}set mode(e){this.vars.amigaInsData[2]=e}get waveLen(){return this.vars.amigaInsData[3]}set waveLen(e){this.vars.amigaInsData[3]=e}get waveSize(){return this.vars.amigaInsData[16]}set waveSize(e){this.vars.amigaInsData[16]=e}get volumeMacro(){return this.vars.volumeMacro}get arpeggioMacro(){return this.vars.arpeggioMacro}get pitchMacro(){return this.vars.pitchMacro}get phaseResetMacro(){return this.vars.phaseResetMacro}}t.FurnaceInstrumentViewAmiga=g},548:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.FurnaceInstrumentModule=void 0;const r=a(817),n=a(235),s=a(433),o=a(525),i=a(360),l=a(154);class c{constructor(){this.version=n.defaults.version,this.instruments=[s.FurnaceInstrument.create()],this.wavetables=[],this.samples=[],this.meta=o.FurnaceMeta.create()}static create(){return new c}static fromHelper(e){const t=c.create();if(c.magic!==e.getASCII(16))throw new Error('Expected format magic string "'+c.magic+'" when loading an instrument module.');t.version=e.readUInt16LE(),e.skipBytes(2);const a=[e.readUInt32LE()],r=[],n=e.readUInt16LE(),h=[],u=e.readUInt16LE();e.skipBytes(4);for(let t=0;t<n;t++)r.push(e.readUInt32LE());for(let t=0;t<u;t++)h.push(e.readUInt32LE());return t.instruments=a.map((t=>{const a=e.getPosition(0);e.setPosition(t);const r=s.FurnaceInstrument.fromHelper(e);return e.setPosition(a),r})),t.wavetables=r.map((t=>{const a=e.getPosition(0);e.setPosition(t);const r=l.FurnaceWavetable.fromHelper(e);return e.setPosition(a),r})),t.samples=h.map((a=>{const r=e.getPosition(0);e.setPosition(a);const n=i.FurnaceSample.fromHelper(e,t.version);return e.setPosition(r),n})),t.meta=o.FurnaceMeta.checkFromHelper(e),t}getAsBuffer(){const e=new r.BufferWriteHelper;if(e.writeString(c.magic,"ascii",!1),e.writeUInt16LE(this.version),e.skipBytes(2),1!==this.instruments.length)throw new Error("Expected instrument module to contain 1 instrument, but it contains "+this.wavetables.length+"!");if(this.wavetables.length>256)throw new Error("At most 256 wavetables are supported, but "+this.wavetables.length+" were defined!");if(this.samples.length>256)throw new Error("At most 256 samples are supported, but "+this.samples.length+" were defined!");const t=e.getPosition(0);e.skipBytes(4*this.instruments.length),e.writeUInt16LE(this.wavetables.length),e.writeUInt16LE(this.samples.length),e.skipBytes(4);const a=e.getPosition(0);e.skipBytes(4*this.wavetables.length);const n=e.getPosition(0);return e.skipBytes(4*this.samples.length),this.instruments.forEach(((a,r)=>{e.writeUInt32LE(e.getPosition(0),t+4*r),a.writeToBuffer(e)})),this.wavetables.forEach(((t,r)=>{e.writeUInt32LE(e.getPosition(0),a+4*r),t.writeToBuffer(e)})),this.samples.forEach(((t,a)=>{e.writeUInt32LE(e.getPosition(0),n+4*a),t.writeToBuffer(e,this.version)})),this.meta.writeToBuffer(e),e.getTrimmedBuffer()}getVersion(){return this.version}}t.FurnaceInstrumentModule=c,c.magic="-Furnace instr.-"},718:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.FurnaceOperatorMacro=t.FurnaceArpeggioMacro=t.FurnaceMacroWithHeight=t.FurnaceGenericMacro=void 0;class a{constructor(){this.data=[],this.loop=null,this.release=null,this.open=!0,this.valueOffset=0,this.mode=0}}t.FurnaceGenericMacro=a,t.FurnaceMacroWithHeight=class extends a{constructor(){super(),this.height=null}},t.FurnaceArpeggioMacro=class extends a{constructor(){super(),this.isAbsolute=!1}},t.FurnaceOperatorMacro=class extends a{constructor(e){super(),this.operator=e}}},525:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.FurnaceMeta=void 0;const r=a(235);class n{constructor(){this.version=r.defaults.version,this.toolName=r.defaults.toolName,this.toolVersion=r.defaults.toolVersion,this.comment="",this.backupFile="",this.extraStrings=[],this.extraInts=[],this.date=new Date}static create(){return new n}static checkFromHelper(e){const t=e.getPosition(0);return t<e.buffer.byteLength+4&&e.getASCII(4,t)===n.magic?n.fromHelper(e):n.create()}static fromHelper(e){const t=n.create();if(n.magic!==e.getASCII(4))throw new Error('Expected format magic string "'+n.magic+'" when loading a subsong block.');t.version=e.readUInt16LE(),e.skipBytes(2),e.skipBytes(24);for(let a=0;a<e.readUInt16LE();a++)t.extraInts.push(e.readUInt32LE());for(let a=0;a<e.readUInt16LE();a++)t.extraStrings.push(e.readString("utf-8"));t.toolName=e.readString("utf-8"),t.toolVersion=e.readString("utf-8");try{const a=e.readString("utf-8");t.date=new Date(a)}catch(e){t.date=new Date(0)}return t.comment=e.readString("utf-8"),t.backupFile=e.readString("utf-8"),t}writeToBuffer(e){e.writeString(n.magic,"ascii",!1),e.writeUInt16LE(this.version),e.skipBytes(2),e.skipBytes(24),e.writeUInt16LE(this.extraInts.length);for(let t=0;t<this.extraInts.length;t++)e.writeUInt32LE(this.extraInts[t]);e.writeUInt16LE(this.extraStrings.length);for(let t=0;t<this.extraStrings.length;t++)e.writeString(this.extraStrings[t],"utf8",!0);e.writeString(this.toolName,"utf8",!0),e.writeString(this.toolVersion,"utf8",!0),e.writeString(this.date.toISOString(),"utf8",!0),e.writeString(this.comment,"utf8",!0),e.writeString(this.backupFile,"utf8",!0)}}t.FurnaceMeta=n,n.magic="META"},762:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.FurnaceRow=t.FurnacePattern=void 0;const r=a(235);class n{constructor(e,t){this.name=r.defaults.patternName,this.rows=[];for(let a=0;a<e;a++)this.rows.push(new s(t))}static create(e,t){return new n(e,t)}static fromHelper(e,t){const a=n.create(0,0);if(n.magic!==e.getASCII(4))throw new Error('Expected format magic string "'+n.magic+'" when loading a pattern block.');e.skipBytes(4);const r=e.readUInt16LE(),s=e.readUInt16LE(),o=e.readUInt16LE();return e.skipBytes(2),{pattern:a,channel:r,index:s,song:t<95?0:o}}loadData(e,t,a,r){for(let t=0;t<a;t++){const t=new s(r);this.rows.push(t),t.fromHelper(e)}t>=51&&(this.name=e.readString("utf-8"))}writeToBuffer(e,t,a,r,s){const o=e.getPosition(8);e.writeString(n.magic,"ascii",!1),e.skipBytes(4),e.writeUInt16LE(a),e.writeUInt16LE(r),e.writeUInt16LE(s),e.skipBytes(2);for(const t of this.rows)t.writeToBuffer(e);t>=51&&e.writeString(this.name,"utf-8",!0),e.writeUInt32LE(e.getPosition()-o,o-4)}}t.FurnacePattern=n,n.magic="PATR";class s{constructor(e){this.note=null,this.instrument=null,this.volume=null,this.effects=[];for(let t=0;t<e;t++)this.effects.push({id:null,value:null})}fromHelper(e){const t=e.readInt16LE(),a=e.readInt8();e.skipBytes(1),this.note=0===t?null:{note:t,octave:a},this.instrument=e.readUInt16LE(),this.volume=e.readUInt16LE(),65535===this.instrument&&(this.instrument=null),65535===this.volume&&(this.volume=null);for(const t of this.effects)t.id=e.readUInt16LE(),t.value=e.readUInt16LE(),65535===t.id&&(t.id=null),65535===t.value&&(t.value=null)}writeToBuffer(e){var t,a,r,n;this.note?(e.writeInt16LE(this.note.note),e.writeInt8(this.note.octave),e.skipBytes(1)):(e.writeUInt16LE(0),e.writeUInt16LE(0)),e.writeUInt16LE(null!==(t=this.instrument)&&void 0!==t?t:65535),e.writeUInt16LE(null!==(a=this.volume)&&void 0!==a?a:65535);for(const t of this.effects)e.writeUInt16LE(null!==(r=t.id)&&void 0!==r?r:65535),e.writeUInt16LE(null!==(n=t.value)&&void 0!==n?n:65535)}}t.FurnaceRow=s},360:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Furnace16bitSample=t.Furnace8bitSample=t.FurnaceSample=void 0;const r=a(235);class n{constructor(){this.name=r.defaults.sampleName,this.compatRate=r.defaults.sampleRate,this.c4Rate=r.defaults.sampleRate,this.loopStart=null,this.loopEnd=null,this.volume=null,this.pitch=null,this.data=s.create(),this.precense=[0,0,0,0]}static create(){return new n}static fromHelper(e,t){const a=n.create(),r=e.getASCII(4),s=n.magic===r;if(!s&&n.magic2!==r)throw new Error('Expected format magic string "'+n.magic+'" or "'+n.magic2+'" when loading a sample block.');e.skipBytes(4),a.name=e.readString("utf-8");const o=e.readUInt32LE();a.compatRate=e.readUInt32LE(),s?(a.volume=e.readInt16LE(),a.pitch=e.readInt16LE(),t>=58&&(a.volume=null,a.pitch=null)):(a.volume=null,a.pitch=null,a.c4Rate=e.readUInt32LE());const i=e.readUInt8(),l=n.getFormatFunctionFromId(i);s?(e.skipBytes(1),a.c4Rate=e.readUInt16LE(),a.loopStart=e.readUInt32LE(),a.loopEnd=o,a.precense=[0,0,0,0]):(e.skipBytes(3),a.loopStart=e.readUInt32LE(),a.loopEnd=e.readUInt32LE(),a.precense=[e.readUInt32LE(),e.readUInt32LE(),e.readUInt32LE(),e.readUInt32LE()]),4294967295===a.loopStart&&(a.loopStart=null),4294967295===a.loopEnd&&(a.loopEnd=null);const c=e.getPosition(0),h=e.buffer.subarray(c,c+o*(t<58?2:n.getFormatMultiply(i)));return a.data=l(h,o),a}static getFormatMultiply(e){switch(e){case 8:return 1;case 16:return 2}throw new Error("Unknown or unsupported sample format id "+e)}static getFormatFunctionFromId(e){switch(e){case 8:return s.fromBuffer;case 16:return o.fromBuffer}throw new Error("Unknown or unsupported sample format id "+e)}writeToBuffer(e,t){t>=102?this.writeToBufferSMP2(e):this.writeToBufferSMPL(e,t)}writeToBufferSMP2(e){var t,a;const r=e.getPosition(8);e.writeString(n.magic2,"ascii",!1),e.skipBytes(4),e.writeString(this.name,"utf-8",!0),e.writeUInt32LE(this.data.entries/n.getFormatMultiply(this.data.formatId)),e.writeUInt32LE(this.compatRate),e.writeUInt32LE(this.c4Rate),e.writeUInt8(this.data.formatId),e.skipBytes(3),e.writeUInt32LE(null!==(t=this.loopStart)&&void 0!==t?t:4294967295),e.writeUInt32LE(null!==(a=this.loopEnd)&&void 0!==a?a:4294967295),e.writeUInt32LE(this.precense[0]),e.writeUInt32LE(this.precense[1]),e.writeUInt32LE(this.precense[2]),e.writeUInt32LE(this.precense[3]),e.writeBuffer(this.data.rawBuffer,0,this.data.rawBuffer.length),e.writeUInt32LE(e.getPosition()-r,r-4)}writeToBufferSMPL(e,t){var a,r,s;const o=e.getPosition(8);e.writeString(n.magic,"ascii",!1),e.skipBytes(4),e.writeString(this.name,"utf-8",!0),e.writeUInt32LE(this.data.entries/(t<58?2:n.getFormatMultiply(this.data.formatId))),e.writeUInt32LE(this.compatRate),e.writeInt16LE(null!==(a=this.volume)&&void 0!==a?a:0),e.writeInt16LE(null!==(r=this.pitch)&&void 0!==r?r:0),e.writeUInt8(this.data.formatId),e.skipBytes(1),e.writeUInt16LE(this.c4Rate),e.writeUInt32LE(null!==(s=this.loopStart)&&void 0!==s?s:4294967295),e.writeBuffer(this.data.rawBuffer,0,this.data.rawBuffer.length),e.writeUInt32LE(e.getPosition()-o,o-4)}}t.FurnaceSample=n,n.magic="SMPL",n.magic2="SMP2";class s{constructor(){this.formatName="8-bit PCM",this.formatId=8,this.entries=0}static create(){const e=new s;return e.rawBuffer=Buffer.alloc(0),e}static fromBuffer(e,t){const a=new s;return a.rawBuffer=e,a.entries=t,a}convertToArray(){const e=new Int16Array(this.entries);for(let t=0;t<this.entries;t++)e[t]=this.rawBuffer.readInt8(t)<<8;return e}convertFromArray(e){this.entries=e.length,this.rawBuffer=Buffer.alloc(this.entries);for(let t=0;t<this.entries;t++)this.rawBuffer.writeInt8(e[t]>>8,t)}}t.Furnace8bitSample=s;class o{constructor(){this.formatName="16-bit PCM",this.formatId=16,this.entries=0}static create(){const e=new o;return e.rawBuffer=Buffer.alloc(0),e}static fromBuffer(e,t){const a=new o;return a.rawBuffer=e,a.entries=t,a}convertToArray(){const e=new Int16Array(this.entries);for(let t=0;t<this.entries;t++)e[t]=this.rawBuffer.readInt16LE(2*t);return e}convertFromArray(e){this.entries=e.length,this.rawBuffer=Buffer.alloc(2*this.entries);for(let t=0;t<this.entries;t++)this.rawBuffer.writeInt16LE(e[t],2*t)}}t.Furnace16bitSample=o},262:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.FurnaceSong=void 0;const r=a(61),n=a(235);class s{constructor(){this.timebase=n.defaults.timebase,this.speed1=n.defaults.speed1,this.speed2=n.defaults.speed2,this.highlightA=n.defaults.highlightA,this.highlightB=n.defaults.highlightB,this.initialArpeggioTime=1,this.ticksPerSecond=n.defaults.tps,this.virtualTempoNumerator=n.defaults.tempo,this.virtualTempoDenominator=n.defaults.tempo,this.name=n.defaults.songName,this.comment=n.defaults.songComment,this.rows=n.defaults.rows,this.channels=null,this.channelInfo=[]}static create(){return new s}static fromHelper(e,t,a){const n=s.create();if(s.magic!==e.getASCII(4))throw new Error('Expected format magic string "'+s.magic+'" when loading a subsong block.');e.skipBytes(4),n.timebase=e.readUInt8()+1,n.speed1=e.readUInt8(),n.speed2=e.readUInt8(),n.initialArpeggioTime=e.readUInt8(),n.ticksPerSecond=e.readFloat32LE(),n.rows=e.readUInt16LE();const o=e.readUInt16LE();if(n.rows>256)throw new Error("Expected at most 256 rows in a pattern, but "+n.rows+" were loaded.");if(o>256)throw new Error("Expected at most 256 orders in a subsong, but "+o+" were loaded.");return n.highlightA=e.readUInt8(),n.highlightB=e.readUInt8(),n.virtualTempoNumerator=e.readUInt16LE(),n.virtualTempoDenominator=e.readUInt16LE(),n.name=e.readString("utf-8"),n.comment=e.readString("utf-8"),n.fetchChannels(e,a,(0,r.computeChannelCount)(t),o),n}fetchChannels(e,t,a,n){for(let e=0;e<a;e++)this.channelInfo.push(new r.FurnaceChannelInfo);for(let a=0;a<this.channelInfo.length;a++)this.channelInfo[a].orders=[...e.readBuffer(n)].map((e=>e&(t<80?127:255)));for(let t=0;t<this.channelInfo.length;t++)this.channelInfo[t].effects=e.readUInt8();for(let t=0;t<this.channelInfo.length;t++)this.channelInfo[t].hidden=0===e.readUInt8();for(let t=0;t<this.channelInfo.length;t++)this.channelInfo[t].collapsed=0===e.readUInt8();for(let t=0;t<this.channelInfo.length;t++)this.channelInfo[t].longname=e.readString("ascii");for(let t=0;t<this.channelInfo.length;t++)this.channelInfo[t].shortname=e.readString("ascii")}writeToBuffer(e){const t=e.getPosition(8);e.writeString(s.magic,"ascii",!1),e.skipBytes(4),e.writeUInt8(this.timebase-1),e.writeUInt8(this.speed1),e.writeUInt8(this.speed2),e.writeUInt8(this.initialArpeggioTime),e.writeFloat32LE(this.ticksPerSecond),e.writeUInt16LE(this.rows),e.writeUInt16LE(this.channelInfo[0].orders.length),e.writeUInt8(this.highlightA),e.writeUInt8(this.highlightB),e.writeUInt16LE(this.virtualTempoNumerator),e.writeUInt16LE(this.virtualTempoDenominator),e.writeString(this.name,"utf-8",!0),e.writeString(this.comment,"utf-8",!0),this.writeChannels(e),e.writeUInt32LE(e.getPosition()-t,t-4)}writeChannels(e){for(let t=0;t<this.channelInfo.length;t++)e.writeBuffer(Buffer.from(this.channelInfo[t].orders),0,this.channelInfo[t].orders.length);e.writeBuffer(Buffer.from(this.channelInfo.map((e=>e.effects))),0,this.channelInfo.length),e.writeBuffer(Buffer.from(this.channelInfo.map((e=>e.hidden?0:1))),0,this.channelInfo.length),e.writeBuffer(Buffer.from(this.channelInfo.map((e=>e.collapsed?0:1))),0,this.channelInfo.length);for(let t=0;t<this.channelInfo.length;t++)e.writeString(this.channelInfo[t].longname,"ascii",!0);for(let t=0;t<this.channelInfo.length;t++)e.writeString(this.channelInfo[t].shortname,"ascii",!0)}getChannels(e){return this.channels?this.channels:this.channels=(0,r.computeChannelObjects)(e,this.channelInfo)}}t.FurnaceSong=s,s.magic="SONG"},441:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.FurnaceSongModule=void 0;const r=a(817),n=a(235),s=a(470),o=a(525);class i{constructor(){this.version=n.defaults.version,this.info=s.FurnaceInfo.create(),this.meta=o.FurnaceMeta.create()}static create(){return new i}static fromHelper(e){const t=i.create();if(i.magic!==e.getASCII(16))throw new Error('Expected format magic string "'+i.magic+'" when loading a song module.');return t.version=e.readUInt16LE(),e.skipBytes(2),e.setPosition(e.readUInt32LE()),t.info=s.FurnaceInfo.fromHelper(e,t.version),t}getAsBuffer(){const e=new r.BufferWriteHelper;e.writeString(i.magic,"ascii",!1),e.writeUInt16LE(this.version),e.skipBytes(2);const t=e.getPosition(0);return e.skipBytes(4),e.skipBytes(8),e.writeUInt32LE(e.getPosition(0),t),this.info.writeToBuffer(e,this.version),this.meta.writeToBuffer(e),e.getTrimmedBuffer()}getVersion(){return this.version}}t.FurnaceSongModule=i,i.magic="-Furnace module-"},154:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.FurnaceWavetable=void 0;const r=a(235);class n{constructor(){this.name=r.defaults.wavetableName,this.data=new Int32Array(0),this.min=r.defaults.wavetableMin,this.max=r.defaults.wavetableMax}static create(){return new n}static fromHelper(e){const t=n.create();if(n.magic!==e.getASCII(4))throw new Error('Expected format magic string "'+n.magic+'" when loading a wavetable block.');e.skipBytes(4),t.name=e.readString("utf-8");const a=e.readUInt32LE();t.min=e.readUInt32LE(),t.max=e.readUInt32LE();const r=e.readBuffer(4*a);return t.data=Int32Array.from(r),t}writeToBuffer(e){const t=e.getPosition(8);e.writeString(n.magic,"ascii",!1),e.skipBytes(4),e.writeString(this.name,"utf-8",!0),e.writeUInt32LE(this.data.length),e.writeUInt32LE(this.min),e.writeUInt32LE(this.max),e.writeBuffer(Buffer.from(this.data),0,4*this.data.length),e.writeUInt32LE(e.getPosition()-t,t-4)}}t.FurnaceWavetable=n,n.magic="WAVE"},676:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.FurnaceWavetableModule=void 0;const r=a(817),n=a(235),s=a(525),o=a(154);class i{constructor(){this.version=n.defaults.version,this.wavetables=[o.FurnaceWavetable.create()],this.meta=s.FurnaceMeta.create()}static create(){return new i}static fromHelper(e){const t=i.create();if(i.magic!==e.getASCII(16))throw new Error('Expected format magic string "'+i.magic+'" when loading a wavetable module.');return t.version=e.readUInt16LE(),e.skipBytes(2),t.wavetables=[o.FurnaceWavetable.fromHelper(e)],t.meta=s.FurnaceMeta.checkFromHelper(e),t}getAsBuffer(){const e=new r.BufferWriteHelper;if(e.writeString(i.magic,"ascii",!1),e.writeUInt16LE(this.version),e.skipBytes(2),1!==this.wavetables.length)throw new Error("Expected wavetable module to contain 1 wavetable, but it contains "+this.wavetables.length+"!");return this.wavetables[0].writeToBuffer(e),this.meta.writeToBuffer(e),e.getTrimmedBuffer()}getVersion(){return this.version}}t.FurnaceWavetableModule=i,i.magic="-Furnace waveta-"},908:function(e,t,a){var r=this&&this.__createBinding||(Object.create?function(e,t,a,r){void 0===r&&(r=a);var n=Object.getOwnPropertyDescriptor(t,a);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[a]}}),Object.defineProperty(e,r,n)}:function(e,t,a,r){void 0===r&&(r=a),e[r]=t[a]}),n=this&&this.__exportStar||function(e,t){for(var a in e)"default"===a||Object.prototype.hasOwnProperty.call(t,a)||r(t,e,a)};Object.defineProperty(t,"__esModule",{value:!0}),n(a(770),t)},796:e=>{e.exports=require("zlib")}},t={};return function a(r){var n=t[r];if(void 0!==n)return n.exports;var s=t[r]={exports:{}};return e[r].call(s.exports,s,s.exports,a),s.exports}(908)})()));